System.register(["jimu-core/react","jimu-core","jimu-ui"],(function(e,t){var a={},n={},r={};return{setters:[function(e){a.default=e.default,a.useEffect=e.useEffect,a.useMemo=e.useMemo,a.useRef=e.useRef,a.useState=e.useState},function(e){n.DataSourceManager=e.DataSourceManager},function(e){r.Alert=e.Alert,r.Button=e.Button,r.Checkbox=e.Checkbox,r.Collapse=e.Collapse,r.Loading=e.Loading,r.Select=e.Select}],execute:function(){e((()=>{var e={8891:e=>{"use strict";e.exports=n},1315:e=>{"use strict";e.exports=a},726:e=>{"use strict";e.exports=r}},t={};function l(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,l),r.exports}l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var o={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(o),l.d(o,{__set_webpack_public_path__:()=>c,default:()=>u});var e=l(1315),t=l(8891),a=l(726),n=function(e,t,a,n){return new(a||(a=Promise))((function(r,l){function o(e){try{u(n.next(e))}catch(e){l(e)}}function i(e){try{u(n.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}u((n=n.apply(e,t||[])).next())}))};const r="__ESRI_NULL__",i=["Tipo_accidente","Sentido"];function u(l){var o,u;const c=null===(u=null===(o=l.useDataSources)||void 0===o?void 0:o[0])||void 0===u?void 0:u.dataSourceId,s=(0,e.useRef)(null),[d,m]=(0,e.useState)(!1),[f,p]=(0,e.useState)(!1),[v,g]=(0,e.useState)(null),[S,y]=(0,e.useState)([]),[h,b]=(0,e.useState)(""),[E,w]=(0,e.useState)([]),[N,x]=(0,e.useState)(new Set);(0,e.useEffect)((()=>{if(g(null),m(!1),!c)return;const e=t.DataSourceManager.getInstance().getDataSource(c);s.current=null!=e?e:null,null==e||e.ready().then((()=>m(!0))).catch((e=>{console.error(e),g("No se pudo inicializar el DataSource.")}))}),[c]),(0,e.useEffect)((()=>{var e;if(!d||!s.current)return;const t=s.current.getSchema(),a=Object.values(null!==(e=null==t?void 0:t.fields)&&void 0!==e?e:{}).map((e=>{var t;return{name:e.name,alias:null!==(t=e.alias)&&void 0!==t?t:e.name,type:e.type}})),n=a.filter((e=>i.includes(e.name)));n.sort(((e,t)=>(e.alias||e.name).localeCompare(t.alias||t.name))),y(n),0===n.length?g(`No se encontraron en la capa los campos: ${i.join(", ")}`):b((e=>e&&n.some((t=>t.name===e))?e:n[0].name))}),[d]),(0,e.useEffect)((()=>{if(!d||!s.current||!h)return;let e=!1;return p(!0),g(null),(()=>{n(this,void 0,void 0,(function*(){var t;try{const a={where:"1=1",groupByFieldsForStatistics:[h],outStatistics:[{statisticType:"count",onStatisticField:h,outStatisticFieldName:"n"}],orderByFields:[`${h} ASC`],returnGeometry:!1,pageSize:2e3},n=yield s.current.query(a),l=(null!==(t=null==n?void 0:n.records)&&void 0!==t?t:[]).map((e=>{const t=e.getFieldValue(h);return null==t?r:String(t)})),o=Array.from(new Set(l));e||(w(o),x(new Set(o)))}catch(t){console.error(t),e||g("Error consultando categorías del campo.")}finally{e||p(!1)}}))})(),()=>{e=!0}}),[d,h]),(0,e.useEffect)((()=>{C()}),[N,h]);const _=(0,e.useMemo)((()=>{var e,t;return null!==(t=null===(e=S.find((e=>e.name===h)))||void 0===e?void 0:e.type)&&void 0!==t?t:"esriFieldTypeString"}),[S,h]),C=()=>n(this,void 0,void 0,(function*(){const e=s.current;if(!e||!h)return;if(0===N.size)return void(yield e.updateQueryParams({where:"1=0"},l.id));if(N.size===E.length)return void(yield e.updateQueryParams({where:"1=1"},l.id));const t=Array.from(N).filter((e=>e!==r)),a=N.has(r),n="esriFieldTypeString"===_,o=t.map((e=>{if(n)return`'${e.replace(/'/g,"''")}'`;const t=Number(e);return Number.isFinite(t)?String(t):`'${e.replace(/'/g,"''")}'`})),i=[o.length?`${h} IN (${o.join(",")})`:"",a?`${h} IS NULL`:""].filter(Boolean).map((e=>`(${e})`)).join(" OR ")||"1=0";yield e.updateQueryParams({where:i},l.id)}));return e.default.createElement("div",{className:"p-3",style:{overflow:"auto",height:"100%"}},!c&&e.default.createElement(a.Alert,{type:"warning",text:"Selecciona un DataSource en la configuración del widget."}),v&&e.default.createElement(a.Alert,{className:"mb-2",type:"error",text:v}),e.default.createElement("div",{className:"mb-3"},e.default.createElement("div",{className:"mb-1 font-weight-bold"},"Simbología (campo)"),e.default.createElement(a.Select,{size:"sm",value:h,onChange:e=>b(e.target.value),disabled:!d||0===S.length},S.map((t=>e.default.createElement("option",{key:t.name,value:t.name},t.alias," (",t.name,")"))))),e.default.createElement("div",{className:"border-top pt-2"},e.default.createElement("div",{className:"d-flex align-items-center justify-content-between"},e.default.createElement("div",{className:"font-weight-bold"},"Categorías de ",h||"—"),e.default.createElement("div",{className:"text-muted",style:{fontSize:12}},E.length?`${N.size}/${E.length}`:"—")),e.default.createElement("div",{className:"d-flex gap-2 my-2"},e.default.createElement(a.Button,{size:"sm",type:"tertiary",onClick:()=>x(new Set(E)),disabled:f||0===E.length},"Todo"),e.default.createElement(a.Button,{size:"sm",type:"tertiary",onClick:()=>x(new Set),disabled:f||0===E.length},"Ninguno")),f&&e.default.createElement(a.Loading,null),!f&&0===E.length&&e.default.createElement("div",{className:"text-muted"},"Sin categorías (o pendiente de carga)."),e.default.createElement(a.Collapse,{isOpen:!0},e.default.createElement("div",{className:"pl-1",style:{maxHeight:320,overflow:"auto"}},E.map((t=>{return e.default.createElement("div",{key:`${h}|${t}`,className:"d-flex align-items-center mb-1"},e.default.createElement(a.Checkbox,{checked:N.has(t),onChange:(e,a)=>((e,t)=>{x((a=>{const n=new Set(a);return t?n.add(e):n.delete(e),n}))})(t,a)}),e.default.createElement("span",{className:"ml-2"},(n=t)===r?"(vacío)":n));var n}))))))}function c(e){l.p=e}})(),o})())}}}));
/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core","jimu-core/react","jimu-core/react-dom","jimu-arcgis","jimu-ui"],(function(e,t){var r={},o={},n={},a={},i={};return Object.defineProperty(o,"__esModule",{value:!0}),{setters:[function(e){r.DataSourceManager=e.DataSourceManager,r.Immutable=e.Immutable,r.React=e.React,r.appActions=e.appActions,r.getAppStore=e.getAppStore},function(e){Object.keys(e).forEach((function(t){o[t]=e[t]}))},function(e){n.unstable_batchedUpdates=e.unstable_batchedUpdates},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.Switch=e.Switch}],execute:function(){e((()=>{var e={8679:(e,t,r)=>{"use strict";var o=r(9864),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(e){return o.isMemo(e)?i:s[e.$$typeof]||n}s[o.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[o.Memo]=i;var l=Object.defineProperty,u=Object.getOwnPropertyNames,p=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,m=Object.prototype;e.exports=function e(t,r,o){if("string"!=typeof r){if(m){var n=f(r);n&&n!==m&&e(t,n,o)}var i=u(r);p&&(i=i.concat(p(r)));for(var s=c(t),y=c(r),g=0;g<i.length;++g){var S=i[g];if(!(a[S]||o&&o[S]||y&&y[S]||s&&s[S])){var v=d(r,S);try{l(t,S,v)}catch(e){}}}}return t}},9921:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,o=r?Symbol.for("react.element"):60103,n=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,i=r?Symbol.for("react.strict_mode"):60108,s=r?Symbol.for("react.profiler"):60114,c=r?Symbol.for("react.provider"):60109,l=r?Symbol.for("react.context"):60110,u=r?Symbol.for("react.async_mode"):60111,p=r?Symbol.for("react.concurrent_mode"):60111,d=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,y=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,S=r?Symbol.for("react.block"):60121,v=r?Symbol.for("react.fundamental"):60117,b=r?Symbol.for("react.responder"):60118,h=r?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case u:case p:case a:case s:case i:case f:return e;default:switch(e=e&&e.$$typeof){case l:case d:case g:case y:case c:return e;default:return t}}case n:return t}}}function x(e){return w(e)===p}t.AsyncMode=u,t.ConcurrentMode=p,t.ContextConsumer=l,t.ContextProvider=c,t.Element=o,t.ForwardRef=d,t.Fragment=a,t.Lazy=g,t.Memo=y,t.Portal=n,t.Profiler=s,t.StrictMode=i,t.Suspense=f,t.isAsyncMode=function(e){return x(e)||w(e)===u},t.isConcurrentMode=x,t.isContextConsumer=function(e){return w(e)===l},t.isContextProvider=function(e){return w(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return w(e)===d},t.isFragment=function(e){return w(e)===a},t.isLazy=function(e){return w(e)===g},t.isMemo=function(e){return w(e)===y},t.isPortal=function(e){return w(e)===n},t.isProfiler=function(e){return w(e)===s},t.isStrictMode=function(e){return w(e)===i},t.isSuspense=function(e){return w(e)===f},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===p||e===s||e===i||e===f||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===y||e.$$typeof===c||e.$$typeof===l||e.$$typeof===d||e.$$typeof===v||e.$$typeof===b||e.$$typeof===h||e.$$typeof===S)},t.typeOf=w},9864:(e,t,r)=>{"use strict";e.exports=r(9921)},8359:(e,t)=>{"use strict";Symbol.for("react.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.provider"),Symbol.for("react.context"),Symbol.for("react.server_context"),Symbol.for("react.forward_ref"),Symbol.for("react.suspense"),Symbol.for("react.suspense_list"),Symbol.for("react.memo"),Symbol.for("react.lazy"),Symbol.for("react.offscreen");Symbol.for("react.module.reference")},2973:(e,t,r)=>{"use strict";r(8359)},3250:(e,t,r)=>{"use strict";var o=r(1315),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=o.useState,i=o.useEffect,s=o.useLayoutEffect,c=o.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),o=a({inst:{value:r,getSnapshot:t}}),n=o[0].inst,u=o[1];return s((function(){n.value=r,n.getSnapshot=t,l(n)&&u({inst:n})}),[e,r,t]),i((function(){return l(n)&&u({inst:n}),e((function(){l(n)&&u({inst:n})}))}),[e]),c(r),r};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},139:(e,t,r)=>{"use strict";var o=r(1315),n=r(1688),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=n.useSyncExternalStore,s=o.useRef,c=o.useEffect,l=o.useMemo,u=o.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,o,n){var p=s(null);if(null===p.current){var d={hasValue:!1,value:null};p.current=d}else d=p.current;p=l((function(){function e(e){if(!c){if(c=!0,i=e,e=o(e),void 0!==n&&d.hasValue){var t=d.value;if(n(t,e))return s=t}return s=e}if(t=s,a(i,e))return t;var r=o(e);return void 0!==n&&n(t,r)?t:(i=e,s=r)}var i,s,c=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]}),[t,r,o,n]);var f=i(e,p[0],p[1]);return c((function(){d.hasValue=!0,d.value=f}),[f]),u(f),f}},1688:(e,t,r)=>{"use strict";e.exports=r(3250)},2798:(e,t,r)=>{"use strict";e.exports=r(139)},6826:e=>{"use strict";e.exports=a},8891:e=>{"use strict";e.exports=r},1315:e=>{"use strict";e.exports=o},800:e=>{"use strict";e.exports=n},726:e=>{"use strict";e.exports=i}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var c={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(c),s.d(c,{__set_webpack_public_path__:()=>P,default:()=>R});var e=s(8891),t=s(1688),r=s(2798),o=s(800);let n=null;var a=s(1315);const i=Symbol.for("react-redux-context"),l="undefined"!=typeof globalThis?globalThis:{};function u(){var e;if(!a.createContext)return{};const t=null!=(e=l[i])?e:l[i]=new Map;let r=t.get(a.createContext);return r||(r=a.createContext(null),t.set(a.createContext,r)),r}const p=u();function d(e=p){return function(){return(0,a.useContext)(e)}}const f=d();let m=()=>{throw new Error("uSES not initialized!")};const y=(e,t)=>e===t;function g(e=p){const t=e===p?f:d(e);return function(e,r={}){const{equalityFn:o=y,stabilityCheck:n,noopCheck:i}="function"==typeof r?{equalityFn:r}:r,{store:s,subscription:c,getServerState:l,stabilityCheck:u,noopCheck:p}=t(),d=((0,a.useRef)(!0),(0,a.useCallback)({[e.name]:t=>e(t)}[e.name],[e,u,n])),f=m(c.addNestedSub,s.getState,l||s.getState,d,o);return(0,a.useDebugValue)(f),f}}const S=g();s(8679),s(2973),"undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?a.useLayoutEffect:a.useEffect;let v=null;var b;b=r.useSyncExternalStoreWithSelector,m=b,(e=>{v=e})(t.useSyncExternalStore),n=o.unstable_batchedUpdates;var h=s(6826),w=s(726);const{useState:x,useEffect:E}=e.React,C=/\s+and\s+/i,_=/ IN\s*\(/i,A=/(PK|Año|V|NACVS|Carretera|NACV|NACVM)\b/i,O=e=>A.test(e),j=e=>(e||"").replace(/^\(+|\)+$/g,""),I=e=>(e||"").replace(/\)\s*$/,""),$=e=>{const t=(e||"").split(_);return t[1]?I(t[1]):null},T=e=>{if(!e)return null;const t=j(e.trim());if(r=t,!_.test(r)||O(t))return null;var r;const o=t.split(_);return o[1]?`(${o[0]} IN (${I(o[1])}))`:null},F=e=>{const t=[];return e?(e.split(C).forEach((e=>{const r=T(e);r&&t.push(r)})),t):t};function R(t){var r,o,n;const[a,i]=x(),[s,c]=x("Ninguno"),[l,u]=x((0,e.Immutable)([])),[p,d]=x([]),[f,m]=x(!1),[y,g]=x("Tipo_accidente"),[v,b]=x(!1),[C,A]=x(!0),[R,P]=x({}),M=e.DataSourceManager.getInstance(),[N,k]=x([]),D=t.useDataSources[0],V=M.getDataSource(D.dataSourceId);function q(e){const r={where:e||""};V.updateQueryParams(r,t.id)}const z=e=>{let t="";return e.forEach((e=>{"https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"===e.url&&"Accidentes"===e.title&&(console.log(e),t=e.definitionExpression||"")})),t||console.log("No se ha encotrado la capa https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"),console.log("currentFilter"),console.log(t),t||""};e.React.useEffect((()=>{var r,o,n;if(null===(r=null==t?void 0:t.stateProps)||void 0===r?void 0:r.clearAllFiltersTrigger){B();try{(null==a?void 0:a.view)&&(a.view.map.layers.items.forEach((e=>{(null==e?void 0:e.definitionExpression)&&(e.definitionExpression=null)})),null===(n=(o=a.view).requestRender)||void 0===n||n.call(o))}catch(e){}(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(t.id,"clearAllFiltersTrigger",0))}}),[null===(r=null==t?void 0:t.stateProps)||void 0===r?void 0:r.clearAllFiltersTrigger]),E((()=>{if(a){if(a){let t;a.view.map.layers.items.forEach((e=>{"https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"===e.url&&"Accidentes"===e.title&&(t=e)}));const r=t.createQuery();r.maxRecordCountFactor=3,r.outFields=["Año"];let o=[];t.queryFeatures(r).then((t=>{t.features.forEach((e=>{const t=e.attributes["Año"];o.push(t)})),o=Array.from(new Set(o));const r=Math.max(...o),n=JSON.parse(JSON.stringify((0,e.getAppStore)().getState().appConfig)).widgets.widget_19.config,a=n.filterItems[0].sqlExprObj.displaySQL;n.filterItems[0].sqlExprObj.displaySQL=a.replace("2025",r.toString()),n.filterItems[0].sqlExprObj.parts[0].valueOptions.value[1].label=r.toString(),n.filterItems[0].sqlExprObj.parts[0].valueOptions.value[1].value=r,n.filterItems[0].sqlExprObj.sql=n.filterItems[0].sqlExprObj.sql.replace("2025",r.toString()),(0,e.getAppStore)().getState().appConfig.messageConfigs.messageConfig_1={id:"messageConfig_1",widgetId:"widget_17",messageType:"DATA_SOURCE_FILTER_CHANGE",actions:[{actionId:"widget_1-zoomToFeature-1718779068116",widgetId:"widget_1",messageWidgetId:"widget_17",actionName:"zoomToFeature",description:null,config:{useDataSource:{dataSourceId:"dataSource_1-AccidentesSeys_1709_5211",mainDataSourceId:"dataSource_1-AccidentesSeys_1709_5211",rootDataSourceId:"dataSource_1"},useDataSources:[{dataSourceId:"dataSource_1-AccidentesSeys_1709_5211",mainDataSourceId:"dataSource_1-AccidentesSeys_1709_5211",rootDataSourceId:"dataSource_1"}],isUseCustomZoomToOption:!0,zoomToOption:{scale:1e5}},version:"1.14.0",useDataSources:[]}]}}));const n={Tipo_accidente:[],Subtipo_Accidente:[],Sentido:[],Superficie:[],Luminosidad:[],Factores_atmosfericos:[],Tipo_dia:[],Año:[],Factor_concurrente_1:[]};t.load().then((()=>{const e=t.createQuery();e.maxRecordCountFactor=3,t.queryFeatures(e).then((e=>{e.features.forEach((e=>{for(const t in n){const r=e.attributes[t];n[t].push(r)}}));for(const e in n)n[e]=Array.from(new Set(n[e]));P(n)}))}))}}else console.warn("jmvs aún no está definido")}),[a]);const W=S((e=>e.appConfig.counter),((e,t)=>e===t)),U=S((e=>e.appConfig.attUnique),((e,t)=>e===t)),L=S((e=>e.appConfig.campo),((e,t)=>e===t));E((()=>{L&&(g(L),B())}),[L]),E((()=>{var e;const t=s.includes(", ")?s.split(", "):[s];if(l&&a)for(const r of l){let o=!0;for(const n of t)if(r.label===n.replace(";",",")){let t=z(a.view.map.layers.items)||"";t&&t.includes(" and ")&&t.split(" and ").forEach((e=>{const t=T(e);if(t&&!O(t)&&t.includes(y)){const e=$(t);if(e)if(e.includes("', '")){const t=e.split("', '").map((e=>e.replace(/'/g,"")));d(t)}else d([e.replace(/'/g,"")])}}));const r=[];null===(e=R[y])||void 0===e||e.forEach((e=>{const t={};t.label=e,t.value=e,r.push(t)})),u(r),o=!1;break}if(!o)break}}),[y]),E((()=>{let e;U?(e=U,e=Array.isArray(e)?e:Object.keys(e)):e=["Salidas de vía","Colisiones","Alcances","Choques","Otros","Atropellos de animales","Caídas","Vuelcos","Atropellos de peatones","Sin datos"];const t=[];e.forEach((e=>{let r={};r.label=e,r.value=e,t.push(r)})),u(t);const r=s.includes(", ")?s.split(", "):[s];for(const e of t){let t=!0;for(const o of r)if(e.label===o.replace(";",",")){A(!1),m(!0),t=!1;break}if(!t)break}(500,new Promise((e=>setTimeout(e,500)))).then((()=>{A(!0)}))}),[U]),E((()=>{const e=setInterval((()=>{var t,r,o,n;if(W&&(null===(n=null===(o=null===(r=null===(t=null==a?void 0:a.view)||void 0===t?void 0:t.map)||void 0===r?void 0:r.layers)||void 0===o?void 0:o.items)||void 0===n?void 0:n.length)){let t=z(a.view.map.layers.items)||"";t=F(t).join(" and "),q(t),m(!1),d([]),clearInterval(e)}}),200);return()=>clearInterval(e)}),[W]);const B=()=>{a&&(q(""),d([]),c("Ninguno"),m(!1))};return E((()=>{if(0===p.length){const e=Object.keys(l).filter((e=>l[e]));d(e)}}),[]),E((()=>{if(p&&a&&C){const t=function(e){let t="";if(e.length>1){const r=e.join("', '");t=y?"("+y+" IN ('"+r+"'))":"(Tipo_accidente IN ('"+r+"'))"}else{const r=e[0];t=y?"("+y+" IN ('"+r+"'))":"(Tipo_accidente IN ('"+r+"'))"}return t}(p);let r=z(a.view.map.layers.items)||"";const o=[];console.log("jmvs.view.map"),console.log(a.view.map),r.includes(" and ")&&r.split(" and ").forEach((e=>{const t=T(e);t&&o.push(t)})),r=o.join(" and "),f?q(""===r?t:r+" and "+t):r.includes(" and "+t+")")?q(r.replace(" and "+t+")","")):r.includes(" and "+t)?q(r.replace(" and "+t,"")):r.includes(t+" and ")?q(r.replace(t+" and ","")):q(r.replace(t,""));const n=z(a.view.map.layers.items)||"";c(function(t){if(console.log("clausula"),console.log(t),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange("widget_168","categoryFieldOverride",function(e){if(!e)return[];const t=e.match(/\bIN\s*\(\s*([^)]+)\s*\)/i);return t?t[1].split(",").map((e=>e.trim().replace(/^'+|'+$/g,""))).filter(Boolean):[]}(t))),!t||"string"!=typeof t)return"Ninguno";const r=F(t);if(!r.length)return"Ninguno";const o=[];return r.forEach((e=>{const t=j(e).split(_),r=t[1]?I(t[1]):"";if(r)if(r.includes("', '")){const e=r.split("', '").map((e=>e.replace(/'/g,"").replace(/,/g,";")));o.push(e.join(", "))}else o.push(r.replace(/'/g,"").replace(/,/g,";"))})),o.join(", ")||"Ninguno"}(n))}}),[f]),e.React.useEffect((()=>{var r;(null===(r=null==t?void 0:t.stateProps)||void 0===r?void 0:r.restartTrigger)&&(function(){try{V.updateQueryParams({where:""},t.id),g("Tipo_accidente"),m(!1),d([]),c("Ninguno"),u((0,e.Immutable)([])),A(!0),b(!1),function(t){let r=Array.isArray(R[t])?R[t]:[];r.length||(Array.isArray(U)?r=U:U&&(r=Object.keys(U))),(null==r?void 0:r.length)||(r=["Alcances","Atropellos de animales","Atropellos de peatones","Caidas","Choques","Colisiones","Otros","Salidas de vía","Sin datos"]);const o=(r||[]).filter((e=>null!=e&&""!==e)).map((e=>({label:e,value:e})));u((0,e.Immutable)(o))}("Tipo_accidente")}catch(e){console.warn("Restart falló:",e)}}(),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(t.id,"restartTrigger",0)))}),[null===(o=null==t?void 0:t.stateProps)||void 0===o?void 0:o.restartTrigger]),e.React.createElement("div",{style:{display:"flex,",width:"100%",height:"100%"}},t.useMapWidgetIds&&1===t.useMapWidgetIds.length&&e.React.createElement(h.JimuMapViewComponent,{useMapWidgetId:null===(n=t.useMapWidgetIds)||void 0===n?void 0:n[0],onActiveViewChange:e=>{console.log("JimuMapView recibido:",e),e&&i(e)}}),e.React.createElement("div",{style:{marginRight:"10px",marginLeft:"5px",marginTop:"10px"}},e.React.createElement("div",{style:{marginBottom:"10px"}},e.React.createElement(w.Switch,{checked:f,onChange:()=>{m(!f)}})),e.React.createElement("div",{style:{maxHeight:"240px",overflow:"auto"}},l.filter((e=>e&&e.value&&""!==e.value)).map(((t,r)=>{const o=p.includes(t.value);return e.React.createElement("label",{key:r,style:{display:"flex",alignItems:"center",marginBottom:"5px",cursor:f?"default":"pointer",userSelect:"none"}},e.React.createElement("input",{type:"checkbox",disabled:f,checked:o,onChange:()=>function(e){const t=e.value;if(p.includes(t)){let e=[...p];e=e.filter((e=>e!==t)),d(e)}else d([...p,t])}(t),style:{opacity:0,width:0,height:0,position:"absolute"}}),e.React.createElement("span",{style:{height:"18px",width:"18px",border:"2px solid "+(o?"#007BFF":"#ccc"),backgroundColor:o?"#007BFF":"white",display:"inline-block",marginRight:"10px",borderRadius:"4px",position:"relative"}},o&&e.React.createElement("span",{style:{content:"",position:"absolute",top:"1px",left:"4px",width:"5px",height:"10px",border:"solid white",borderWidth:"0 2px 2px 0",transform:"rotate(45deg)"}})),e.React.createElement("span",{style:{color:o?"#007BFF":"#999"}},t.value))}))),"Ninguno"!==s&&s.length>0&&e.React.createElement("div",{style:{marginTop:"10px"}},e.React.createElement("button",{onClick:B,style:{backgroundColor:"white",color:"#333",border:"1px solid #ccc",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s ease"},onMouseOver:e=>e.target.style.backgroundColor="#d5d5d5",onMouseOut:e=>e.target.style.backgroundColor="white"},"Eliminar todos los filtros"))))}function P(e){s.p=e}})(),c})())}}}));
System.register(["jimu-core","jimu-arcgis","jimu-core/react","jimu-ui/advanced/setting-components","esri/renderers/UniqueValueRenderer","esri/smartMapping/renderers/pieChart","jimu-ui"],(function(e,o){var a={},r={},n={},t={},l={},i={},c={};return{setters:[function(e){a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.getAppStore=e.getAppStore},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default,n.useEffect=e.useEffect,n.useState=e.useState},function(e){t.SettingSection=e.SettingSection},function(e){l.default=e.default},function(e){i.createRendererForClustering=e.createRendererForClustering},function(e){c.Button=e.Button,c.Loading=e.Loading,c.MultiSelect=e.MultiSelect,c.Select=e.Select}],execute:function(){e((()=>{var e={6849:e=>{"use strict";e.exports=l},2618:e=>{"use strict";e.exports=i},6826:e=>{"use strict";e.exports=r},8891:e=>{"use strict";e.exports=a},1315:e=>{"use strict";e.exports=n},726:e=>{"use strict";e.exports=c},7756:e=>{"use strict";e.exports=t}},o={};function s(a){var r=o[a];if(void 0!==r)return r.exports;var n=o[a]={exports:{}};return e[a](n,n.exports,s),n.exports}s.d=(e,o)=>{for(var a in o)s.o(o,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})},s.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var d={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(d),s.d(d,{__set_webpack_public_path__:()=>p,default:()=>g});var e=s(8891);const o={_widgetLabel:"Leyenda dinámica",chooseAttribute:"Visualización por atributo"};var a=s(6826),r=s(1315),n=s(7756),t=s(6849),l=s(2618),i=s(726);const c=JSON.parse('{"Tipo_accidente":{"salidas_de_via":{"color":"rgba(203, 0, 203, 1)","nombre":"Salidas de vía"},"colisiones":{"color":"rgba(101, 178, 255, 1)","nombre":"Colisiones"},"alcances":{"color":"rgba(255, 153, 50, 1)","nombre":"Alcances"},"choques":{"color":"rgba(153, 255, 229, 1)","nombre":"Choques"},"otros":{"color":"rgba(0, 63, 255, 1)","nombre":"Otros"},"atropellos_de_animales":{"color":"rgba(255, 255, 50, 1)","nombre":"Atropellos de animales"},"caidas":{"color":"rgba(140, 255, 101, 1)","nombre":"Caídas"},"vuelcos":{"color":"rgba(255, 0, 197, 1)","nombre":"Vuelcos"},"atropellos_de_peatones":{"color":"rgba(216, 255, 101, 1)","nombre":"Atropellos de peatones"},"sin_datos":{"color":"rgba(182, 182, 182, 1)","nombre":"Sin datos"},"no_definido":{"color":"rgba(214, 214, 214, 1)","nombre":"No definido"}},"Sentido":{"Ascendente":{"color":"rgba(255,125,125,1)","nombre":"Ascendente"},"Descendente":{"color":"rgba(77,147,217,1)","nombre":"Descendente"},"Sin_datos":{"color":"rgba(151,151,151,1)","nombre":"Sin datos"}},"Superficie":{"no_consta":{"color":"rgba(191,191,191,1)","nombre":"No consta"},"seca_y_limpia":{"color":"rgba(190,233,173,1)","nombre":"Seca y limpia"},"umbria":{"color":"rgba(184,231,254,1)","nombre":"Umbría"},"mojada":{"color":"rgba(94,184,246,1)","nombre":"Mojada"},"muy_encharcado_o_inundado":{"color":"rgba(15,65,177,1)","nombre":"Muy encharcado o inundado"},"helada":{"color":"rgba(238,245,252,1)","nombre":"Helada"},"nevada":{"color":"rgba(255,255,243,1)","nombre":"Nevada"},"aceite":{"color":"rgba(255,255,153,1)","nombre":"Aceite"},"con_barro_o_gravilla_suelta":{"color":"rgba(255,190,125,1)","nombre":"Con barro o gravilla suelta"},"gravilla_suelta":{"color":"rgba(255,224,193,1)","nombre":"Gravilla suelta"},"barrillo":{"color":"rgba(255,155,55,1)","nombre":"Barrillo"},"otro_tipo":{"color":"rgba(217,179,255,1)","nombre":"Otro tipo"},"sin_datos":{"color":"rgba(151,151,151,1)","nombre":"Sin datos"}},"Luminosidad":{"no_consta":{"color":"rgba(191,191,191,1)","nombre":"No consta"},"luz_del_dia_natural_solar":{"color":"rgba(255,255,75,1)","nombre":"Luz del día natural, solar"},"amanecer_o_atardecer_con_luz_artificial":{"color":"rgba(255,219,105,1)","nombre":"Amanecer o atardecer con luz artificial"},"amanecer_o_atardecer_sin_luz_artificial":{"color":"rgba(255,176,97,1)","nombre":"Amanecer o atardecer sin luz artificial"},"sin_luz_natural_luz_artificial_suficiente":{"color":"rgba(255,225,255,1)","nombre":"Sin luz natural, luz artificial suficiente"},"sin_luz_natural_luz_artificial_insuficiente":{"color":"rgba(37,105,173,1)","nombre":"Sin luz natural, luz artificial insuficiente"},"sin_iluminacion_natural_ni_artificial":{"color":"rgba(21,61,100,1)","nombre":"Sin iluminación natural ni artificial"},"crepusculo":{"color":"rgba(244,191,162,1)","nombre":"Crepúsculo"},"sin_datos":{"color":"rgba(151,151,151,1)","nombre":"Sin datos"}},"Factores_atmosfericos":{"no_consta":{"color":"rgba(191,191,191,1)","nombre":"No consta"},"despejado":{"color":"rgba(255,255,75,1)","nombre":"Despejado"},"niebla_intensa":{"color":"rgba(240,241,227,1)","nombre":"Niebla intensa"},"niebla_ligera":{"color":"rgba(255,255,204,1)","nombre":"Niebla ligera"},"lluvia_debil":{"color":"rgba(185,255,255,1)","nombre":"Lluvia débil"},"lluvia_fuerte":{"color":"rgba(117,171,225,1)","nombre":"Lluvia fuerte"},"granizando":{"color":"rgba(37,105,173,1)","nombre":"Granizando"},"nevando":{"color":"rgba(21,61,100,1)","nombre":"Nevando"},"viento_fuerte":{"color":"rgba(241,169,131,1)","nombre":"Viento fuerte"},"nublado":{"color":"rgba(217,217,217,1)","nombre":"Nublado"},"otro":{"color":"rgba(217,179,255,1)","nombre":"Otro"},"sin_datos":{"color":"rgba(151,151,151,1)","nombre":"Sin datos"}},"Tipo_dia":{"festivo":{"color":"rgba(255,124,128,1)","nombre":"Festivo"},"laborable":{"color":"rgba(190,233,173,1)","nombre":"Laborable"},"posterior_a_festivo":{"color":"rgba(217,179,255,1)","nombre":"Posterior a festivo"},"vispera_de_festivo":{"color":"rgba(255,190,125,1)","nombre":"Víspera de festivo"},"sin_datos":{"color":"rgba(151,151,151,1)","nombre":"Sin datos"}},"Factor_Concurrente_3":{"adelantamiento_antirreglamentario":{"color":"rgba(255,215,175,1)","nombre":"Adelantamiento antirreglamentario"},"alcohol":{"color":"rgba(74,154,42,1)","nombre":"Alcohol"},"alcohol_o_drogas":{"color":"rgba(190,233,173,1)","nombre":"Alcohol o drogas"},"averia_mecanica":{"color":"rgba(185,255,255,1)","nombre":"Avería mecánica"},"caida_de_carga_en_la_calzada":{"color":"rgba(255,219,105,1)","nombre":"Caída de carga en la calzada"},"cansancio_sueno_o_enfermedad":{"color":"rgba(245,235,255,1)","nombre":"Cansancio, sueño o enfermedad"},"conduccion_distraida_o_desatenta":{"color":"rgba(217,179,255,1)","nombre":"Conducción distraida o desatenta"},"conduccion_negligente":{"color":"rgba(255,55,60,1)","nombre":"Conducción negligente"},"conduccion_temeraria":{"color":"rgba(255,124,128,1)","nombre":"Conducción temeraria"},"distraccion":{"color":"rgba(217,179,255,1)","nombre":"Distracción"},"drogas":{"color":"rgba(190,233,173,1)","nombre":"Drogas"},"enfermedad":{"color":"rgba(21,61,100,1)","nombre":"Enfermedad"},"estado_o_condicion_de_la_senalizacion":{"color":"rgba(238,238,238,1)","nombre":"Estado o condición de la señalización"},"estado_o_condicion_de_la_via":{"color":"rgba(191,191,191,1)","nombre":"Estado o condición de la vía"},"giro_incorrecto":{"color":"rgba(254,218,227,1)","nombre":"Giro incorrecto"},"inexperiencia_del_conductor":{"color":"rgba(176,254,235,1)","nombre":"Inexperiencia del conductor"},"infraccion_a_norma_de_circulacion":{"color":"rgba(255,175,177,1)","nombre":"Infracción a norma de circulación"},"irrumpir_animal_en_calzada":{"color":"rgba(213,171,129,1)","nombre":"Irrumpir animal en calzada"},"irrumpir_peaton_en_calzada":{"color":"rgba(164,109,54,1)","nombre":"Irrumpir peatón en calzada"},"mal_estado_del_vehiculo":{"color":"rgba(117,171,225,1)","nombre":"Mal estado del vehículo"},"meteorologia_adversa":{"color":"rgba(37,105,173,1)","nombre":"Meteorología adversa"},"no_mantener_intervalo_de_seguridad":{"color":"rgba(255,182,109,1)","nombre":"No mantener intervalo de seguridad"},"no_respetar_prioridad":{"color":"rgba(255,153,51,1)","nombre":"No respetar prioridad"},"obstaculo_en_calzada":{"color":"rgba(255,219,105,1)","nombre":"Obstáculo en calzada"},"otro_factor":{"color":"rgba(255,193,255,1)","nombre":"Otro factor"},"presencia_de_un_obstaculo_en_la_calzada":{"color":"rgba(255,219,105,1)","nombre":"Presencia de un obstáculo en la calzada"},"sin_opinion_definida":{"color":"rgba(255,255,204,1)","nombre":"Sin opinión definida"},"tramo_en_obras":{"color":"rgba(255,255,75,1)","nombre":"Tramo en obras"},"velocidad_inadecuada":{"color":"rgba(190,125,255,1)","nombre":"Velocidad inadecuada"}},"Subtipo_Accidente":{"alcance":{"color":"rgba(255,224,193,1)","nombre":"Alcance"},"multiple_o_en_caravana":{"color":"rgba(255,153,51,1)","nombre":"Múltiple o en caravana"},"caida_en_calzada":{"color":"rgba(0,255,0,1)","nombre":"Caida en calzada"},"choque_con_arbol_o_poste":{"color":"rgba(255,225,255,1)","nombre":"Choque con árbol o poste"},"choque_con_arbol_o_poste_izqd":{"color":"rgba(215,107,205,1)","nombre":"Choque con árbol o poste izqd"},"choque_con_cuneta_o_bordillo":{"color":"rgba(37,105,173,1)","nombre":"Choque con cuneta o bordillo"},"choque_con_cuneta_o_bordillo_izqd":{"color":"rgba(21,61,100,1)","nombre":"Choque con cuneta o bordillo izqd"},"choque_con_murete_o_edificio":{"color":"rgba(190,233,173,1)","nombre":"Choque con murete o edificio"},"choque_con_murete_o_edificio_izqd":{"color":"rgba(74,154,42,1)","nombre":"Choque con murete o edificio izqd"},"otro_tipo_de_choque":{"color":"rgba(213,171,129,1)","nombre":"Otro tipo de choque"},"otro_tipo_de_choque_izqd":{"color":"rgba(164,109,54,1)","nombre":"Otro tipo de choque izqd"},"en_llano":{"color":"rgba(255,255,75,1)","nombre":"En llano"},"en_llano_izqd":{"color":"rgba(255,219,105,1)","nombre":"En llano izqd"},"con_vuelco":{"color":"rgba(255,175,177,1)","nombre":"Con vuelco"},"con_vuelco_izqd":{"color":"rgba(255,124,128,1)","nombre":"Con vuelco izqd"},"con_despenamiento":{"color":"rgba(245,235,255,1)","nombre":"Con despeñamiento"},"con_despenamiento_izqd":{"color":"rgba(217,179,255,1)","nombre":"Con despeñamiento izqd"},"otra_salida":{"color":"rgba(199,199,199,1)","nombre":"Otra salida"},"otra_salida_izqd":{"color":"rgba(138,138,138,1)","nombre":"Otra salida izqd"},"solo_salida_de_via":{"color":"rgba(204,56,186,1)","nombre":"Sólo Salida de Vía"},"despenamiento":{"color":"rgba(81,21,74,1)","nombre":"Despeñamiento"},"vuelco_en_la_calzada":{"color":"rgba(253,23,138,1)","nombre":"Vuelco en la calzada"},"otro":{"color":"rgba(0,0,255,1)","nombre":"Otro"},"frontal":{"color":"rgba(192,230,245,1)","nombre":"Frontal"},"frontolateral":{"color":"rgba(94,184,246,1)","nombre":"Frontolateral"},"lateral":{"color":"rgba(6,83,136,1)","nombre":"Lateral"},"obstaculo_o_elemento_de_la_via":{"color":"rgba(176,254,235,1)","nombre":"Obstáculo o elemento de la vía"},"otro_objeto_o_material":{"color":"rgba(15,241,214,1)","nombre":"Otro objeto o material"},"vehiculo_estacionado_averiado":{"color":"rgba(10,178,158,1)","nombre":"Vehículo estacionado/averiado"},"barrera_de_paso_a_nivel":{"color":"rgba(6,98,87,1)","nombre":"Barrera de paso a nivel"},"valla_de_defensa":{"color":"rgba(11,245,156,1)","nombre":"Valla de defensa"},"choque_contra_barrera_de_seguridad":{"color":"rgba(24,130,74,1)","nombre":"Choque contra barrera de seguridad"},"peaton_aislado":{"color":"rgba(139,208,0,1)","nombre":"Peatón aislado"},"peaton_aislado_o_en_grupo":{"color":"rgba(97,146,0,1)","nombre":"Peatón aislado o en grupo"},"peaton_sosteniendo_bicicleta":{"color":"rgba(194,255,71,1)","nombre":"Peatón sosteniendo bicicleta"},"peaton_reparando_vehiculo":{"color":"rgba(159,248,144,1)","nombre":"Peatón reparando vehículo"},"conductor_de_animales":{"color":"rgba(217,201,83,1)","nombre":"Conductor de animales"},"animal_conducido_o_rebano":{"color":"rgba(255,255,0,1)","nombre":"Animal conducido o rebaño"},"animales_sueltos":{"color":"rgba(255,255,159,1)","nombre":"Animales sueltos"}}}');var u=function(e,o,a,r){return new(a||(a=Promise))((function(n,t){function l(e){try{c(r.next(e))}catch(e){t(e)}}function i(e){try{c(r.throw(e))}catch(e){t(e)}}function c(e){var o;e.done?n(e.value):(o=e.value,o instanceof a?o:new a((function(e){e(o)}))).then(l,i)}c((r=r.apply(e,o||[])).next())}))};const b=e=>{if(!e)return"";const o={inudado:"inundado",encharcado:"encharcado",gravilla:"gravilla",barro:"barro"};let a=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();Object.keys(o).forEach((e=>{a=a.replace(new RegExp(e,"g"),o[e])}));const r=["de","del","la","el","los","las","o","y"];return a=a.split(/\s+/).filter((e=>!r.includes(e))).join(" "),a=a.replace(/[^a-z0-9]+/g,"_"),a.replace(/^_|_$/g,"")},m=e=>{const o=null==e?void 0:e.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);return o?[Number(o[1]),Number(o[2]),Number(o[3])]:null},_=(e,o)=>{var a,r=(a=e)?a.charAt(0).toUpperCase()+a.slice(1):"";if(c[r]){for(const e in c[r])if(console.log("Primero:"+c[r][e].nombre.toLowerCase()+"      Segundo:    "+o.toLowerCase()),b(c[r][e].nombre.toLowerCase())===b(o.toLowerCase()))return c[r][e].color;return"rgb(200, 200, 200)"}return null};function g(c){var s;(0,e.Immutable)([e.JimuFieldType.String]);const[d,b]=(0,r.useState)(""),[g,p]=(0,r.useState)(),[f,S]=(0,r.useState)(""),[v,h]=(0,r.useState)((0,e.Immutable)([])),[z,C]=(0,r.useState)([]),[y,q]=(0,r.useState)(!1),[A,M]=(0,r.useState)(!0),[w,E]=(0,r.useState)([]);(0,r.useEffect)((()=>{if(c.useDataSources&&c.useDataSources.length>0){const e=c.useDataSources[0].dataSourceId.split("-")[1];S(e)}}),[c.useDataSources]);const j={Tipo_accidente:"Tipo de accidente",Subtipo_Accidente:"Subtipo de Accidente",Sentido:"Sentido",Superficie:"Superficie",Luminosidad:"Luminosidad",Factores_atmosfericos:"Factores atmosféricos",Tipo_dia:"Tipo de día",Factor_Concurrente_3:"Factor concurrente"};function O(){return[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())]}function N(e){return r.default.createElement(n.SettingSection,{className:"attribute-selector-section",title:"Este atributo tiene más de 10 categorías, límite que el mapa no permite visualizar. Seleccione como máximo 9 atributos para visualizarlos en el mapa."},r.default.createElement(i.MultiSelect,{items:e,placeholder:"Selecione 9 atributos únicos",displayByValues:function(e){return`${e.length} seleccionados`},onClickItem:function(e,o,a){a.length<=10&&C(a)}}))}const x=(e,o)=>u(this,void 0,void 0,(function*(){const{renderer:a,fields:r}=yield l.createRendererForClustering({layer:e,legendOptions:{title:j[d]}}),n=[];let t;r.forEach((e=>{n.push(e.name.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").slice(1,e.name.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").length))})),t="Tipo_accidente"===d?{"Salidas de v a":"Salidas de vía",Colisiones:"Colisiones",Alcances:"Alcances",Choques:"Choques",Otros:"Otros","Atropellos de animales":"Atropellos de animales",Caidas:"Caídas",Vuelcos:"Vuelcos","Atropellos de peatones":"Atropellos de peatones","cluster default":"Agrupación","Sin datos":"Sin datos"}:function(e,o){const a={};o=o.map(String);for(const r of e){const n={},t=[];for(const i of o){let c=0;if(r.length===i.length)for(let s=0;s<r.length;s++)r[s]===i[s]&&c++;n[c]=i,t.push(c)}function l(e,o){return o-e}t.sort(l),0===t[0]?a[r]=" "===r?" ":"Agrupación":a[r]=n[t[0]]}return a}(n,o);const i=r.map((e=>({fieldName:e.name,label:t[e.name.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").slice(1,e.name.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").length)],format:{places:0,digitSeparator:!0}})));o.length<11&&i.pop();const c={title:"Resumen del clúster",content:[{type:"text",text:"This cluster represents <b>{cluster_count}</b> features. "},{type:"media",mediaInfos:[{title:"Reports",type:"pie-chart",value:{fields:i.map((e=>e.fieldName))}}]},{type:"fields"}],fieldInfos:i};a.attributes.forEach((e=>{var o;const a=e.field.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM",""),r=null!==(o=t[a.slice(1)])&&void 0!==o?o:a.slice(1),n=_(d,r);n&&(e.symbol=e.symbol||{},e.symbol.color=n)})),e.featureReduction={type:"cluster",fields:r,clusterMinSize:25,renderer:a,popupTemplate:c,labelingInfo:[]},q(!1)}));return(0,r.useEffect)((()=>{if(g&&d&&""!==f){const o=g.view.map.findLayerById(f),a=o.getField(d),r=o.createQuery();function n(e,o,a){const r=[],n={};for(const o of e){const e=_(a,String(o));let t,l;if(e){const o=m(e);o?(l=o,t=e):(l=O(),t=l)}else l=O(),t=l;n[String(o)]=l,r.push({value:o,label:o,symbol:{type:"simple-marker",color:t,outline:null,size:6}})}const l=new t.default({field:a,defaultSymbol:{type:"simple-marker",color:[195,195,195],outline:null,size:6},uniqueValueInfos:r});c.onAtt(n),o.renderer=l}r.outFields=[a.name],r.maxRecordCountFactor=3,(()=>u(this,void 0,void 0,(function*(){const n=[];(yield o.queryFeatures(r)).features.forEach((e=>{const o=e.attributes[a.name];n.push(o)}));const t=Array.from(new Set(n));return console.log(t),y&&((0,e.getAppStore)().getState().appConfig.attUnique=t&&t.length?t:["Salidas de vía","Colisiones","Alcances","Choques","Otros","Atropellos de animales","Caídas","Vuelcos","Atropellos de peatones","Sin datos"]),t})))().then((e=>{const r=[];if(e.forEach((e=>{const o={};null===e?(o.value="Sin datos",o.label="Sin datos"):(o.value=e.toString(),o.label=e.toString()),r.push(o)})),h(r),window.attUnique=e,window.valoresAgg=z,y){if(z.length<=25&&0!==z.length){for(const o of e){let e=0;for(const a of z)o===a&&e++;if(0===e){z.push(o);break}}n(z.slice(0,-1),o,a.name)}else n(e,o,a.name);E(e),A?x(o,e):o.featureReduction={},q(!1)}}))}C([])}),[g,d,f,y]),(0,r.useEffect)((()=>{if(g&&d&&void 0!==f){const e=g.view.map.findLayerById(f);A?x(e,w):e.featureReduction={},q(!1)}}),[A]),r.default.createElement("div",{className:"widget-setting-get-map-coordinates"},r.default.createElement("div",{className:"widget-starter jimu-widget"},c.useMapWidgetIds&&1===c.useMapWidgetIds.length&&r.default.createElement(a.JimuMapViewComponent,{useMapWidgetId:null===(s=c.useMapWidgetIds)||void 0===s?void 0:s[0],onActiveViewChange:e=>{e&&p(e)}})),c.useDataSources&&c.useDataSources.length>0&&r.default.createElement(n.SettingSection,{className:"attribute-selector-section",title:c.intl.formatMessage({id:"chooseAttributeSelectorLabel",defaultMessage:o.chooseAttribute})},r.default.createElement(i.Select,{value:d,onChange:(e,o)=>{e&&(b(e.target.value),c.onUpdate(e.target.value))},placeholder:"Seleccione un campo...",autoWidth:!0,menuProps:{showArrow:!0}},Object.keys(j).map((e=>r.default.createElement("option",{key:e,value:e},j[e]))))),"Subtipo_Accidente"===d&&N(v),"Factor_Concurrente_3"===d&&N(v),r.default.createElement(n.SettingSection,{className:"attribute-selector-section"},r.default.createElement(i.Button,{onClick:()=>{q(!0),c.onRun(!0)},size:"sm"},"Ejecutar"),y&&r.default.createElement(i.Loading,{height:200,type:"DONUT",width:200})))}function p(e){s.p=e}})(),d})())}}}));
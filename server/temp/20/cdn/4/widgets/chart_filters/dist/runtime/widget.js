/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core","jimu-core/react","jimu-core/react-dom","jimu-arcgis","jimu-ui"],(function(e,t){var r={},o={},n={},a={},s={};return Object.defineProperty(o,"__esModule",{value:!0}),{setters:[function(e){r.DataSourceManager=e.DataSourceManager,r.Immutable=e.Immutable,r.React=e.React,r.getAppStore=e.getAppStore},function(e){Object.keys(e).forEach((function(t){o[t]=e[t]}))},function(e){n.unstable_batchedUpdates=e.unstable_batchedUpdates},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.Switch=e.Switch}],execute:function(){e((()=>{var e={8679:(e,t,r)=>{"use strict";var o=r(9864),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},c={};function i(e){return o.isMemo(e)?s:c[e.$$typeof]||n}c[o.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},c[o.Memo]=s;var l=Object.defineProperty,u=Object.getOwnPropertyNames,p=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,m=Object.prototype;e.exports=function e(t,r,o){if("string"!=typeof r){if(m){var n=d(r);n&&n!==m&&e(t,n,o)}var s=u(r);p&&(s=s.concat(p(r)));for(var c=i(t),y=i(r),g=0;g<s.length;++g){var S=s[g];if(!(a[S]||o&&o[S]||y&&y[S]||c&&c[S])){var b=f(r,S);try{l(t,S,b)}catch(e){}}}}return t}},9921:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,o=r?Symbol.for("react.element"):60103,n=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,c=r?Symbol.for("react.profiler"):60114,i=r?Symbol.for("react.provider"):60109,l=r?Symbol.for("react.context"):60110,u=r?Symbol.for("react.async_mode"):60111,p=r?Symbol.for("react.concurrent_mode"):60111,f=r?Symbol.for("react.forward_ref"):60112,d=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,y=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,S=r?Symbol.for("react.block"):60121,b=r?Symbol.for("react.fundamental"):60117,v=r?Symbol.for("react.responder"):60118,h=r?Symbol.for("react.scope"):60119;function x(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case u:case p:case a:case c:case s:case d:return e;default:switch(e=e&&e.$$typeof){case l:case f:case g:case y:case i:return e;default:return t}}case n:return t}}}function w(e){return x(e)===p}t.AsyncMode=u,t.ConcurrentMode=p,t.ContextConsumer=l,t.ContextProvider=i,t.Element=o,t.ForwardRef=f,t.Fragment=a,t.Lazy=g,t.Memo=y,t.Portal=n,t.Profiler=c,t.StrictMode=s,t.Suspense=d,t.isAsyncMode=function(e){return w(e)||x(e)===u},t.isConcurrentMode=w,t.isContextConsumer=function(e){return x(e)===l},t.isContextProvider=function(e){return x(e)===i},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return x(e)===f},t.isFragment=function(e){return x(e)===a},t.isLazy=function(e){return x(e)===g},t.isMemo=function(e){return x(e)===y},t.isPortal=function(e){return x(e)===n},t.isProfiler=function(e){return x(e)===c},t.isStrictMode=function(e){return x(e)===s},t.isSuspense=function(e){return x(e)===d},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===p||e===c||e===s||e===d||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===y||e.$$typeof===i||e.$$typeof===l||e.$$typeof===f||e.$$typeof===b||e.$$typeof===v||e.$$typeof===h||e.$$typeof===S)},t.typeOf=x},9864:(e,t,r)=>{"use strict";e.exports=r(9921)},8359:(e,t)=>{"use strict";Symbol.for("react.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.provider"),Symbol.for("react.context"),Symbol.for("react.server_context"),Symbol.for("react.forward_ref"),Symbol.for("react.suspense"),Symbol.for("react.suspense_list"),Symbol.for("react.memo"),Symbol.for("react.lazy"),Symbol.for("react.offscreen");Symbol.for("react.module.reference")},2973:(e,t,r)=>{"use strict";r(8359)},3250:(e,t,r)=>{"use strict";var o=r(1315),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=o.useState,s=o.useEffect,c=o.useLayoutEffect,i=o.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),o=a({inst:{value:r,getSnapshot:t}}),n=o[0].inst,u=o[1];return c((function(){n.value=r,n.getSnapshot=t,l(n)&&u({inst:n})}),[e,r,t]),s((function(){return l(n)&&u({inst:n}),e((function(){l(n)&&u({inst:n})}))}),[e]),i(r),r};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},139:(e,t,r)=>{"use strict";var o=r(1315),n=r(1688),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=n.useSyncExternalStore,c=o.useRef,i=o.useEffect,l=o.useMemo,u=o.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,o,n){var p=c(null);if(null===p.current){var f={hasValue:!1,value:null};p.current=f}else f=p.current;p=l((function(){function e(e){if(!i){if(i=!0,s=e,e=o(e),void 0!==n&&f.hasValue){var t=f.value;if(n(t,e))return c=t}return c=e}if(t=c,a(s,e))return t;var r=o(e);return void 0!==n&&n(t,r)?t:(s=e,c=r)}var s,c,i=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]}),[t,r,o,n]);var d=s(e,p[0],p[1]);return i((function(){f.hasValue=!0,f.value=d}),[d]),u(d),d}},1688:(e,t,r)=>{"use strict";e.exports=r(3250)},2798:(e,t,r)=>{"use strict";e.exports=r(139)},6826:e=>{"use strict";e.exports=a},8891:e=>{"use strict";e.exports=r},1315:e=>{"use strict";e.exports=o},800:e=>{"use strict";e.exports=n},726:e=>{"use strict";e.exports=s}},t={};function c(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,c),n.exports}c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var i={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(i),c.d(i,{__set_webpack_public_path__:()=>T,default:()=>R});var e=c(8891),t=c(1688),r=c(2798),o=c(800);let n=null;var a=c(1315);const s=Symbol.for("react-redux-context"),l="undefined"!=typeof globalThis?globalThis:{};function u(){var e;if(!a.createContext)return{};const t=null!=(e=l[s])?e:l[s]=new Map;let r=t.get(a.createContext);return r||(r=a.createContext(null),t.set(a.createContext,r)),r}const p=u();function f(e=p){return function(){return(0,a.useContext)(e)}}const d=f();let m=()=>{throw new Error("uSES not initialized!")};const y=(e,t)=>e===t;function g(e=p){const t=e===p?d:f(e);return function(e,r={}){const{equalityFn:o=y,stabilityCheck:n,noopCheck:s}="function"==typeof r?{equalityFn:r}:r,{store:c,subscription:i,getServerState:l,stabilityCheck:u,noopCheck:p}=t(),f=((0,a.useRef)(!0),(0,a.useCallback)({[e.name]:t=>e(t)}[e.name],[e,u,n])),d=m(i.addNestedSub,c.getState,l||c.getState,f,o);return(0,a.useDebugValue)(d),d}}const S=g();c(8679),c(2973),"undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?a.useLayoutEffect:a.useEffect;let b=null;var v;v=r.useSyncExternalStoreWithSelector,m=v,(e=>{b=e})(t.useSyncExternalStore),n=o.unstable_batchedUpdates;var h=c(6826),x=c(726);const{useState:w,useEffect:E}=e.React,_=/\s+and\s+/i,C=/ IN\s*\(/i,O=/(PK|Año|V|NACVS|Carretera|NACV|NACVM)\b/i,j=e=>O.test(e),I=e=>(e||"").replace(/^\(+|\)+$/g,""),A=e=>(e||"").replace(/\)\s*$/,""),$=e=>{const t=(e||"").split(C);return t[1]?A(t[1]):null},M=e=>{if(!e)return null;const t=I(e.trim());if(r=t,!C.test(r)||j(t))return null;var r;const o=t.split(C);return o[1]?`(${o[0]} IN (${A(o[1])}))`:null},F=e=>{const t=[];return e?(e.split(_).forEach((e=>{const r=M(e);r&&t.push(r)})),t):t};function R(t){var r;const[o,n]=w(),[a,s]=w("Ninguno"),[c,i]=w((0,e.Immutable)([])),[l,u]=w([]),[p,f]=w(!1),[d,m]=w("Tipo_accidente"),[y,g]=w(!1),[b,v]=w(!0),[_,O]=w({}),R=e.DataSourceManager.getInstance(),[T,k]=w([]),N=t.useDataSources[0],P=R.getDataSource(N.dataSourceId);function D(e){const r={where:e||""};P.updateQueryParams(r,t.id)}const V=e=>{let t="";return e.forEach((e=>{"https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"===e.url&&"Accidentes"===e.title&&(console.log(e),t=e.definitionExpression||"")})),t||console.log("No se ha encotrado la capa https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"),console.log("currentFilter"),console.log(t),t||""};E((()=>{if(o){if(o){let t;o.view.map.layers.items.forEach((e=>{"https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"===e.url&&"Accidentes"===e.title&&(t=e)}));const r=t.createQuery();r.maxRecordCountFactor=3,r.outFields=["Año"];let n=[];t.queryFeatures(r).then((t=>{t.features.forEach((e=>{const t=e.attributes["Año"];n.push(t)})),n=Array.from(new Set(n));const r=Math.max(...n),o=JSON.parse(JSON.stringify((0,e.getAppStore)().getState().appConfig)).widgets.widget_19.config,a=o.filterItems[0].sqlExprObj.displaySQL;o.filterItems[0].sqlExprObj.displaySQL=a.replace("2025",r.toString()),o.filterItems[0].sqlExprObj.parts[0].valueOptions.value[1].label=r.toString(),o.filterItems[0].sqlExprObj.parts[0].valueOptions.value[1].value=r,o.filterItems[0].sqlExprObj.sql=o.filterItems[0].sqlExprObj.sql.replace("2025",r.toString()),(0,e.getAppStore)().getState().appConfig.messageConfigs.messageConfig_1={id:"messageConfig_1",widgetId:"widget_17",messageType:"DATA_SOURCE_FILTER_CHANGE",actions:[{actionId:"widget_1-zoomToFeature-1718779068116",widgetId:"widget_1",messageWidgetId:"widget_17",actionName:"zoomToFeature",description:null,config:{useDataSource:{dataSourceId:"dataSource_1-AccidentesSeys_1709_5211",mainDataSourceId:"dataSource_1-AccidentesSeys_1709_5211",rootDataSourceId:"dataSource_1"},useDataSources:[{dataSourceId:"dataSource_1-AccidentesSeys_1709_5211",mainDataSourceId:"dataSource_1-AccidentesSeys_1709_5211",rootDataSourceId:"dataSource_1"}],isUseCustomZoomToOption:!0,zoomToOption:{scale:1e5}},version:"1.14.0",useDataSources:[]}]}}));const a={Tipo_accidente:[],Subtipo_Accidente:[],Sentido:[],Superficie:[],Luminosidad:[],Factores_atmosfericos:[],Tipo_dia:[],Año:[],Factor_concurrente_1:[]};t.load().then((()=>{const e=t.createQuery();e.maxRecordCountFactor=3,t.queryFeatures(e).then((e=>{e.features.forEach((e=>{for(const t in a){const r=e.attributes[t];a[t].push(r)}}));for(const e in a)a[e]=Array.from(new Set(a[e]));O(a)}))}))}}else console.warn("jmvs aún no está definido")}),[o]);const q=S((e=>e.appConfig.counter),((e,t)=>e===t)),z=S((e=>e.appConfig.attUnique),((e,t)=>e===t)),W=S((e=>e.appConfig.campo),((e,t)=>e===t));E((()=>{W&&(m(W),U())}),[W]),E((()=>{var e;const t=a.includes(", ")?a.split(", "):[a];if(c&&o)for(const r of c){let n=!0;for(const a of t)if(r.label===a.replace(";",",")){let t=V(o.view.map.layers.items)||"";t&&t.includes(" and ")&&t.split(" and ").forEach((e=>{const t=M(e);if(t&&!j(t)&&t.includes(d)){const e=$(t);if(e)if(e.includes("', '")){const t=e.split("', '").map((e=>e.replace(/'/g,"")));u(t)}else u([e.replace(/'/g,"")])}}));const r=[];null===(e=_[d])||void 0===e||e.forEach((e=>{const t={};t.label=e,t.value=e,r.push(t)})),i(r),n=!1;break}if(!n)break}}),[d]),E((()=>{let e;z?(e=z,e=Array.isArray(e)?e:Object.keys(e)):e=["Salidas de vía","Colisiones","Alcances","Choques","Otros","Atropellos de animales","Caídas","Vuelcos","Atropellos de peatones","Sin datos"];const t=[];e.forEach((e=>{let r={};r.label=e,r.value=e,t.push(r)})),i(t);const r=a.includes(", ")?a.split(", "):[a];for(const e of t){let t=!0;for(const o of r)if(e.label===o.replace(";",",")){v(!1),f(!0),t=!1;break}if(!t)break}(500,new Promise((e=>setTimeout(e,500)))).then((()=>{v(!0)}))}),[z]),E((()=>{const e=setInterval((()=>{var t,r,n,a;if(q&&(null===(a=null===(n=null===(r=null===(t=null==o?void 0:o.view)||void 0===t?void 0:t.map)||void 0===r?void 0:r.layers)||void 0===n?void 0:n.items)||void 0===a?void 0:a.length)){let t=V(o.view.map.layers.items)||"";t=F(t).join(" and "),D(t),f(!1),u([]),clearInterval(e)}}),200);return()=>clearInterval(e)}),[q]);const U=()=>{o&&(D(""),u([]),s("Ninguno"),f(!1))};return E((()=>{if(0===l.length){const e=Object.keys(c).filter((e=>c[e]));u(e)}}),[]),E((()=>{if(l&&o&&b){const e=function(e){let t="";if(e.length>1){const r=e.join("', '");t=d?"("+d+" IN ('"+r+"'))":"(Tipo_accidente IN ('"+r+"'))"}else{const r=e[0];t=d?"("+d+" IN ('"+r+"'))":"(Tipo_accidente IN ('"+r+"'))"}return t}(l);let t=V(o.view.map.layers.items)||"";const r=[];console.log("jmvs.view.map"),console.log(o.view.map),t.includes(" and ")&&t.split(" and ").forEach((e=>{const t=M(e);t&&r.push(t)})),t=r.join(" and "),p?D(""===t?e:t+" and "+e):t.includes(" and "+e+")")?D(t.replace(" and "+e+")","")):t.includes(" and "+e)?D(t.replace(" and "+e,"")):t.includes(e+" and ")?D(t.replace(e+" and ","")):D(t.replace(e,""));const n=V(o.view.map.layers.items)||"";s(function(e){if(console.log("clausula"),console.log(e),!e||"string"!=typeof e)return"Ninguno";const t=F(e);if(!t.length)return"Ninguno";const r=[];return t.forEach((e=>{const t=I(e).split(C),o=t[1]?A(t[1]):"";if(o)if(o.includes("', '")){const e=o.split("', '").map((e=>e.replace(/'/g,"").replace(/,/g,";")));r.push(e.join(", "))}else r.push(o.replace(/'/g,"").replace(/,/g,";"))})),r.join(", ")||"Ninguno"}(n))}}),[p]),e.React.createElement("div",{style:{display:"flex,",width:"100%",height:"100%"}},t.useMapWidgetIds&&1===t.useMapWidgetIds.length&&e.React.createElement(h.JimuMapViewComponent,{useMapWidgetId:null===(r=t.useMapWidgetIds)||void 0===r?void 0:r[0],onActiveViewChange:e=>{console.log("JimuMapView recibido:",e),e&&n(e)}}),e.React.createElement("div",{style:{marginRight:"10px",marginLeft:"5px",marginTop:"10px"}},e.React.createElement("div",{style:{marginBottom:"10px"}},e.React.createElement(x.Switch,{checked:p,onChange:()=>{f(!p)}})),e.React.createElement("div",{style:{maxHeight:"240px",overflow:"auto"}},c.filter((e=>e&&e.value&&""!==e.value)).map(((t,r)=>{const o=l.includes(t.value);return e.React.createElement("label",{key:r,style:{display:"flex",alignItems:"center",marginBottom:"5px",cursor:p?"default":"pointer",userSelect:"none"}},e.React.createElement("input",{type:"checkbox",disabled:p,checked:o,onChange:()=>function(e){const t=e.value;if(l.includes(t)){let e=[...l];e=e.filter((e=>e!==t)),u(e)}else u([...l,t])}(t),style:{opacity:0,width:0,height:0,position:"absolute"}}),e.React.createElement("span",{style:{height:"18px",width:"18px",border:"2px solid "+(o?"#007BFF":"#ccc"),backgroundColor:o?"#007BFF":"white",display:"inline-block",marginRight:"10px",borderRadius:"4px",position:"relative"}},o&&e.React.createElement("span",{style:{content:"",position:"absolute",top:"1px",left:"4px",width:"5px",height:"10px",border:"solid white",borderWidth:"0 2px 2px 0",transform:"rotate(45deg)"}})),e.React.createElement("span",{style:{color:o?"#007BFF":"#999"}},t.value))}))),"Ninguno"!==a&&a.length>0&&e.React.createElement("div",{style:{marginTop:"10px"}},e.React.createElement("button",{onClick:U,style:{backgroundColor:"white",color:"#333",border:"1px solid #ccc",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s ease"},onMouseOver:e=>e.target.style.backgroundColor="#d5d5d5",onMouseOut:e=>e.target.style.backgroundColor="white"},"Eliminar todos los filtros"))))}function T(e){c.p=e}})(),i})())}}}));
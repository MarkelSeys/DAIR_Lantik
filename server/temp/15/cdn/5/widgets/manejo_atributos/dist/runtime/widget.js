System.register(["jimu-core","jimu-arcgis","jimu-core/react","jimu-ui/advanced/setting-components","esri/renderers/UniqueValueRenderer","esri/smartMapping/renderers/pieChart","jimu-ui"],(function(e,t){var o={},i={},n={},a={},s={},r={},l={};return{setters:[function(e){o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default,n.useEffect=e.useEffect,n.useState=e.useState},function(e){a.SettingSection=e.SettingSection},function(e){s.default=e.default},function(e){r.createRendererForClustering=e.createRendererForClustering},function(e){l.Button=e.Button,l.Loading=e.Loading,l.MultiSelect=e.MultiSelect,l.Select=e.Select,l.Switch=e.Switch}],execute:function(){e((()=>{var e={6849:e=>{"use strict";e.exports=s},2618:e=>{"use strict";e.exports=r},6826:e=>{"use strict";e.exports=i},8891:e=>{"use strict";e.exports=o},1315:e=>{"use strict";e.exports=n},726:e=>{"use strict";e.exports=l},7756:e=>{"use strict";e.exports=a}},t={};function c(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,c),n.exports}c.d=(e,t)=>{for(var o in t)c.o(t,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{__set_webpack_public_path__:()=>p,default:()=>d});var e=c(8891);const t={_widgetLabel:"Leyenda dinámica",chooseAttribute:"Simbolización"};var o=c(6826),i=c(1315),n=c(7756),a=c(6849),s=c(2618),r=c(726),l=function(e,t,o,i){return new(o||(o=Promise))((function(n,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function r(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((i=i.apply(e,t||[])).next())}))};function d(c){var u;(0,e.Immutable)([e.JimuFieldType.String]);const[d,p]=(0,i.useState)("Tipo_accidente"),[f,m]=(0,i.useState)(),[S,g]=(0,i.useState)(""),[h,b]=(0,i.useState)((0,e.Immutable)([])),[y,v]=(0,i.useState)([]),[M,_]=(0,i.useState)(!1),[A,w]=(0,i.useState)(!0),[C,E]=(0,i.useState)([]);(0,i.useEffect)((()=>{if(c.useDataSources&&c.useDataSources.length>0){const e=c.useDataSources[0].dataSourceId.split("-")[1];g(e)}}),[c.useDataSources]);const j={Tipo_accidente:"Tipo de accidente",Subtipo_Accidente:"Subtipo de Accidente",Sentido:"Sentido",Superficie:"Superficie",Luminosidad:"Luminosidad",Factores_atmosfericos:"Factores atmosféricos",Tipo_dia:"Tipo de día",Año:"Año"};function x(){return[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())]}function I(e){return i.default.createElement(n.SettingSection,{className:"attribute-selector-section",title:"Seleccione los atributos que no se quieran resumir"},i.default.createElement(r.MultiSelect,{items:e,placeholder:"Selecione 9 atributos únicos",displayByValues:function(e){return`${e.length} seleccionados`},onClickItem:function(e,t,o){o.length<=9&&v(o)}}))}const T=(e,t)=>l(this,void 0,void 0,(function*(){const{renderer:o,fields:i}=yield s.createRendererForClustering({layer:e,legendOptions:{title:j[d]}}),n=[];let a;i.forEach((e=>{n.push(e.name.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").slice(1,e.name.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").length))})),a="Tipo_accidente"===d?{"Salidas de v a":"Salidas de vía",Colisiones:"Colisiones",Alcances:"Alcances",Choques:"Choques",Otros:"Otros","Atropellos de animales":"Atropellos de animales",Caidas:"Caídas",Vuelcos:"Vuelcos","Atropellos de peatones":"Atropellos de peatones","cluster default":"Agrupación"}:function(e,t){const o={};t=t.map(String);for(const i of e){const n={},a=[];for(const r of t){let l=0;if(i.length===r.length)for(let c=0;c<i.length;c++)i[c]===r[c]&&l++;n[l]=r,a.push(l)}function s(e,t){return t-e}a.sort(s),0===a[0]?o[i]=" "===i?" ":"Agrupación":o[i]=n[a[0]]}return o}(n,t);const r=i.map((e=>({fieldName:e.name,label:a[e.name.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").slice(1,e.name.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").length)],format:{places:0,digitSeparator:!0}})));t.length<11&&r.pop();const l={title:"Resumen del clúster",content:[{type:"text",text:"This cluster represents <b>{cluster_count}</b> features. "},{type:"media",mediaInfos:[{title:"Reports",type:"pie-chart",value:{fields:r.map((e=>e.fieldName))}}]},{type:"fields"}],fieldInfos:r};o.attributes.map((e=>t.length<11&&e.field.includes("default")?o.attributes.splice(o.attributes.findIndex((function(t){return t.field===e.field})),1):e.label=a[e.field.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").slice(1,e.field.split("_").map((e=>e.replace("SUM",""))).join(" ").replace("SUM","").length)])),e.featureReduction={type:"cluster",fields:i,clusterMinSize:16,renderer:o,popupTemplate:l},_(!1)}));return(0,i.useEffect)((()=>{if(f&&d&&""!==S){const e=f.view.map.findLayerById(S),t=e.getField(d),o=e.createQuery();function i(e,t,o){let i={};const n=[];if("Tipo_accidente"===o){const e={"Salidas de vía":[203,0,203],Colisiones:[101,178,255],Alcances:[255,153,50],Choques:[153,255,229],Otros:[0,63,255],"Atropellos de animales":[255,255,50],Caidas:[140,255,101],Vuelcos:[255,0,197],"Atropellos de peatones":[216,255,101]};i=e;for(const t in e){const o={value:t,label:t,symbol:{type:"simple-marker",color:e[t],outline:null,size:6}};n.push(o)}}else if("Subtipo_Accidente"===o||"Año"===o||"Factores_atmosfericos"===o||"Superficie"===o)for(const t of e.slice(0,10)){const e=x();i[t]=e;const o={value:t,label:t,symbol:{type:"simple-marker",color:e,outline:null,size:6}};n.push(o)}else for(const t of e){const e=x();i[t]=e;const o={value:t,label:t,symbol:{type:"simple-marker",color:e,outline:null,size:6}};n.push(o)}const s=new a.default({field:o,defaultSymbol:{type:"simple-marker",color:[195,195,195],outline:null,size:6},uniqueValueInfos:n});t.renderer=s}o.outFields=[t.name],o.maxRecordCountFactor=3,(()=>l(this,void 0,void 0,(function*(){const i=[];return(yield e.queryFeatures(o)).features.forEach((e=>{const o=e.attributes[t.name];i.push(o)})),Array.from(new Set(i))})))().then((o=>{const n=[];if(console.log(o),o.forEach((e=>{const t={};null===e?(t.value="Sin datos",t.label="Sin datos"):(t.value=e.toString(),t.label=e.toString()),n.push(t)})),b(n),M){if(y.length<=9&&0!==y.length){for(const e of o){let t=0;for(const o of y)e===o&&t++;if(0===t){y.push(e);break}}i(y.slice(0,-1),e,t.name)}else i(o,e,t.name);E(o),A?T(e,o):e.featureReduction={},_(!1)}}))}v([])}),[f,d,S,M]),(0,i.useEffect)((()=>{if(f&&d&&void 0!==S){const e=f.view.map.findLayerById(S);A?T(e,C):e.featureReduction={},_(!1)}}),[A]),i.default.createElement("div",{className:"widget-setting-get-map-coordinates"},i.default.createElement("div",{className:"widget-starter jimu-widget"},c.useMapWidgetIds&&1===c.useMapWidgetIds.length&&i.default.createElement(o.JimuMapViewComponent,{useMapWidgetId:null===(u=c.useMapWidgetIds)||void 0===u?void 0:u[0],onActiveViewChange:e=>{e&&m(e)}})),c.useDataSources&&c.useDataSources.length>0&&i.default.createElement(n.SettingSection,{className:"attribute-selector-section",title:c.intl.formatMessage({id:"chooseAttributeSelectorLabel",defaultMessage:t.chooseAttribute})},i.default.createElement(r.Select,{value:d,onChange:(e,t)=>{e&&p(e.target.value)},placeholder:"Seleccione un campo...",autoWidth:!0,menuProps:{showArrow:!0}},Object.keys(j).map((e=>i.default.createElement("option",{key:e,value:e},j[e]))))),"Subtipo_Accidente"===d&&I(h),"Año"===d&&I(h),"Superficie"===d&&I(h),"Factores_atmosfericos"===d&&I(h),i.default.createElement(n.SettingSection,{className:"attribute-selector-section"},i.default.createElement(r.Button,{onClick:()=>{_(!0)},size:"sm"},"Ejecutar"),M&&i.default.createElement(r.Loading,{height:200,type:"DONUT",width:200})),i.default.createElement(n.SettingSection,{className:"attribute-selector-section"},i.default.createElement(r.Switch,{style:{paddingTop:"10px"},checked:A,onChange:()=>{w(!A)}}),"   Activa o desactiva el clúster"))}function p(e){c.p=e}})(),u})())}}}));
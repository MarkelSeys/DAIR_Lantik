/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core","jimu-core/react","jimu-core/react-dom","jimu-arcgis","jimu-ui"],(function(e,t){var r={},o={},n={},c={},a={};return Object.defineProperty(o,"__esModule",{value:!0}),{setters:[function(e){r.DataSourceManager=e.DataSourceManager,r.Immutable=e.Immutable,r.React=e.React,r.appActions=e.appActions,r.getAppStore=e.getAppStore},function(e){Object.keys(e).forEach((function(t){o[t]=e[t]}))},function(e){n.unstable_batchedUpdates=e.unstable_batchedUpdates},function(e){c.JimuMapViewComponent=e.JimuMapViewComponent},function(e){a.Switch=e.Switch}],execute:function(){e((()=>{var e={8679:(e,t,r)=>{"use strict";var o=r(9864),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},c={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function i(e){return o.isMemo(e)?a:s[e.$$typeof]||n}s[o.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[o.Memo]=a;var l=Object.defineProperty,u=Object.getOwnPropertyNames,p=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,m=Object.prototype;e.exports=function e(t,r,o){if("string"!=typeof r){if(m){var n=f(r);n&&n!==m&&e(t,n,o)}var a=u(r);p&&(a=a.concat(p(r)));for(var s=i(t),y=i(r),g=0;g<a.length;++g){var S=a[g];if(!(c[S]||o&&o[S]||y&&y[S]||s&&s[S])){var b=d(r,S);try{l(t,S,b)}catch(e){}}}}return t}},9921:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,o=r?Symbol.for("react.element"):60103,n=r?Symbol.for("react.portal"):60106,c=r?Symbol.for("react.fragment"):60107,a=r?Symbol.for("react.strict_mode"):60108,s=r?Symbol.for("react.profiler"):60114,i=r?Symbol.for("react.provider"):60109,l=r?Symbol.for("react.context"):60110,u=r?Symbol.for("react.async_mode"):60111,p=r?Symbol.for("react.concurrent_mode"):60111,d=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,y=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,S=r?Symbol.for("react.block"):60121,b=r?Symbol.for("react.fundamental"):60117,v=r?Symbol.for("react.responder"):60118,h=r?Symbol.for("react.scope"):60119;function x(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case u:case p:case c:case s:case a:case f:return e;default:switch(e=e&&e.$$typeof){case l:case d:case g:case y:case i:return e;default:return t}}case n:return t}}}function C(e){return x(e)===p}t.AsyncMode=u,t.ConcurrentMode=p,t.ContextConsumer=l,t.ContextProvider=i,t.Element=o,t.ForwardRef=d,t.Fragment=c,t.Lazy=g,t.Memo=y,t.Portal=n,t.Profiler=s,t.StrictMode=a,t.Suspense=f,t.isAsyncMode=function(e){return C(e)||x(e)===u},t.isConcurrentMode=C,t.isContextConsumer=function(e){return x(e)===l},t.isContextProvider=function(e){return x(e)===i},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return x(e)===d},t.isFragment=function(e){return x(e)===c},t.isLazy=function(e){return x(e)===g},t.isMemo=function(e){return x(e)===y},t.isPortal=function(e){return x(e)===n},t.isProfiler=function(e){return x(e)===s},t.isStrictMode=function(e){return x(e)===a},t.isSuspense=function(e){return x(e)===f},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===c||e===p||e===s||e===a||e===f||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===y||e.$$typeof===i||e.$$typeof===l||e.$$typeof===d||e.$$typeof===b||e.$$typeof===v||e.$$typeof===h||e.$$typeof===S)},t.typeOf=x},9864:(e,t,r)=>{"use strict";e.exports=r(9921)},8359:(e,t)=>{"use strict";Symbol.for("react.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.provider"),Symbol.for("react.context"),Symbol.for("react.server_context"),Symbol.for("react.forward_ref"),Symbol.for("react.suspense"),Symbol.for("react.suspense_list"),Symbol.for("react.memo"),Symbol.for("react.lazy"),Symbol.for("react.offscreen");Symbol.for("react.module.reference")},2973:(e,t,r)=>{"use strict";r(8359)},3250:(e,t,r)=>{"use strict";var o=r(1315),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},c=o.useState,a=o.useEffect,s=o.useLayoutEffect,i=o.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),o=c({inst:{value:r,getSnapshot:t}}),n=o[0].inst,u=o[1];return s((function(){n.value=r,n.getSnapshot=t,l(n)&&u({inst:n})}),[e,r,t]),a((function(){return l(n)&&u({inst:n}),e((function(){l(n)&&u({inst:n})}))}),[e]),i(r),r};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},139:(e,t,r)=>{"use strict";var o=r(1315),n=r(1688),c="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=n.useSyncExternalStore,s=o.useRef,i=o.useEffect,l=o.useMemo,u=o.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,o,n){var p=s(null);if(null===p.current){var d={hasValue:!1,value:null};p.current=d}else d=p.current;p=l((function(){function e(e){if(!i){if(i=!0,a=e,e=o(e),void 0!==n&&d.hasValue){var t=d.value;if(n(t,e))return s=t}return s=e}if(t=s,c(a,e))return t;var r=o(e);return void 0!==n&&n(t,r)?t:(a=e,s=r)}var a,s,i=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]}),[t,r,o,n]);var f=a(e,p[0],p[1]);return i((function(){d.hasValue=!0,d.value=f}),[f]),u(f),f}},1688:(e,t,r)=>{"use strict";e.exports=r(3250)},2798:(e,t,r)=>{"use strict";e.exports=r(139)},6826:e=>{"use strict";e.exports=c},8891:e=>{"use strict";e.exports=r},1315:e=>{"use strict";e.exports=o},800:e=>{"use strict";e.exports=n},726:e=>{"use strict";e.exports=a}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var i={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(i),s.d(i,{__set_webpack_public_path__:()=>_,default:()=>E});var e=s(8891),t=s(1688),r=s(2798),o=s(800);let n=null;var c=s(1315);const a=Symbol.for("react-redux-context"),l="undefined"!=typeof globalThis?globalThis:{};function u(){var e;if(!c.createContext)return{};const t=null!=(e=l[a])?e:l[a]=new Map;let r=t.get(c.createContext);return r||(r=c.createContext(null),t.set(c.createContext,r)),r}const p=u();function d(e=p){return function(){return(0,c.useContext)(e)}}const f=d();let m=()=>{throw new Error("uSES not initialized!")};const y=(e,t)=>e===t;function g(e=p){const t=e===p?f:d(e);return function(e,r={}){const{equalityFn:o=y,stabilityCheck:n,noopCheck:a}="function"==typeof r?{equalityFn:r}:r,{store:s,subscription:i,getServerState:l,stabilityCheck:u,noopCheck:p}=t(),d=((0,c.useRef)(!0),(0,c.useCallback)({[e.name]:t=>e(t)}[e.name],[e,u,n])),f=m(i.addNestedSub,s.getState,l||s.getState,d,o);return(0,c.useDebugValue)(f),f}}const S=g();s(8679),s(2973),"undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?c.useLayoutEffect:c.useEffect;let b=null;var v;v=r.useSyncExternalStoreWithSelector,m=v,(e=>{b=e})(t.useSyncExternalStore),n=o.unstable_batchedUpdates;var h=s(6826),x=s(726);const{useState:C,useEffect:w}=e.React;function E(t){var r;const[o,n]=C(),[c,a]=C("Ninguno"),[s,i]=C((0,e.Immutable)([])),[l,u]=C([]),[p,d]=C(!1),[f,m]=C("Tipo_accidente"),[y,g]=C(!1),[b,v]=C(!0),[E,_]=C({}),A=e.DataSourceManager.getInstance(),[O,j]=C([]),I=t.useDataSources[0],N=A.getDataSource(I.dataSourceId);function V(e){const r={where:e};N.updateQueryParams(r,t.id)}const M=e=>{let t;return e.forEach((e=>{"https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"===e.url&&"Accidentes"===e.title&&(console.log(e),t=e.definitionExpression)})),t||console.log("No se ha encotrado la capa https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"),console.log("currentFilter"),console.log(t),t};w((()=>{if(o){if(o){let t;o.view.map.layers.items.forEach((e=>{"https://services-eu1.arcgis.com/hzCnZUsV1OYrzWSi/arcgis/rest/services/AccidentesSeys/FeatureServer"===e.url&&"Accidentes"===e.title&&(t=e)}));const r=t.createQuery();r.maxRecordCountFactor=3,r.outFields=["Año"];let n=[];t.queryFeatures(r).then((t=>{t.features.forEach((e=>{const t=e.attributes["Año"];n.push(t)})),n=Array.from(new Set(n));const r=Math.max(...n),o=JSON.parse(JSON.stringify((0,e.getAppStore)().getState().appConfig)).widgets.widget_19.config,c=o.filterItems[0].sqlExprObj.displaySQL;o.filterItems[0].sqlExprObj.displaySQL=c.replace("2025",r.toString()),o.filterItems[0].sqlExprObj.parts[0].valueOptions.value[1].label=r.toString(),o.filterItems[0].sqlExprObj.parts[0].valueOptions.value[1].value=r,o.filterItems[0].sqlExprObj.sql=o.filterItems[0].sqlExprObj.sql.replace("2025",r.toString()),(0,e.getAppStore)().dispatch(e.appActions.widgetConfigLoaded("widget_19",o)),(0,e.getAppStore)().getState().appConfig.messageConfigs.messageConfig_1={id:"messageConfig_1",widgetId:"widget_17",messageType:"DATA_SOURCE_FILTER_CHANGE",actions:[{actionId:"widget_1-zoomToFeature-1718779068116",widgetId:"widget_1",messageWidgetId:"widget_17",actionName:"zoomToFeature",description:null,config:{useDataSource:{dataSourceId:"dataSource_1-AccidentesSeys_1709_5211",mainDataSourceId:"dataSource_1-AccidentesSeys_1709_5211",rootDataSourceId:"dataSource_1"},useDataSources:[{dataSourceId:"dataSource_1-AccidentesSeys_1709_5211",mainDataSourceId:"dataSource_1-AccidentesSeys_1709_5211",rootDataSourceId:"dataSource_1"}],isUseCustomZoomToOption:!0,zoomToOption:{scale:1e5}},version:"1.14.0",useDataSources:[]}]}}));const c={Tipo_accidente:[],Subtipo_Accidente:[],Sentido:[],Superficie:[],Luminosidad:[],Factores_atmosfericos:[],Tipo_dia:[],Año:[]};t.load().then((()=>{const e=t.createQuery();e.maxRecordCountFactor=3,t.queryFeatures(e).then((e=>{e.features.forEach((e=>{for(const t in c){const r=e.attributes[t];c[t].push(r)}}));for(const e in c)c[e]=Array.from(new Set(c[e]));_(c)}))}))}}else console.warn("jmvs aún no está definido")}),[o]);const $=S((e=>e.appConfig.counter),((e,t)=>e===t)),R=S((e=>e.appConfig.attUnique),((e,t)=>e===t)),F=S((e=>e.appConfig.campo),((e,t)=>e===t));w((()=>{F&&(m(F),P())}),[F]),w((()=>{const e=c.includes(", ")?c.split(", "):[c];if(s)for(const t of s){let r=!0;for(const n of e)if(t.label===n.replace(";",",")){let e=M(o.view.map.layers.items);e.includes(" and ")&&(e=e.split(" and "),e.forEach((t=>{if(t.includes("PK")||t.includes("Año")||t.includes("V")||t.includes("NACVS")||t.includes("Carretera")||t.includes("NACV")||t.includes("NACVM")){if(!(e.includes("PK")||e.includes("Año")||e.includes("V")||e.includes("NACVS")||e.includes("Carretera")||e.includes("NACV")||e.includes("NACVM"))&&e.includes(f)){let e=t.split(" IN (")[1];e.includes("', '")?(e=e.replace(/', '/g,";"),e=e.replace(/\)/g,"").replace(/'/g,""),e=e.split(";"),u(e)):(e=e.replace(/\(/g,"").replace(/\)/g,"").replace(/'/g,""),u([e]))}}else if(t.includes(f)){let e=t.split(" IN (")[1];e.includes("', '")?(e=e.replace(/', '/g,";"),e=e.replace(/\)/g,"").replace(/'/g,""),e=e.split(";"),u(e)):(e=e.replace(/\(/g,"").replace(/\)/g,"").replace(/'/g,""),u([e]))}})));const t=[];E[f].forEach((e=>{const r={};r.label=e,r.value=e,t.push(r)})),i(t),r=!1;break}if(!r)break}}),[f]),w((()=>{let e;R?(e=R,e=Array.isArray(e)?e:Object.keys(e)):e=["Salidas de vía","Colisiones","Alcances","Choques","Otros","Atropellos de animales","Caídas","Vuelcos","Atropellos de peatones"];const t=[];e.forEach((e=>{let r={};r.label=e,r.value=e,t.push(r)})),i(t);const r=c.includes(", ")?c.split(", "):[c];for(const e of t){let t=!0;for(const o of r)if(e.label===o.replace(";",",")){v(!1),d(!0),t=!1;break}if(!t)break}(500,new Promise((e=>setTimeout(e,500)))).then((()=>{v(!0)}))}),[R]),w((()=>{const e=setInterval((()=>{var t,r,n,c;if($&&(null===(c=null===(n=null===(r=null===(t=null==o?void 0:o.view)||void 0===t?void 0:t.map)||void 0===r?void 0:r.layers)||void 0===n?void 0:n.items)||void 0===c?void 0:c.length)){let t=M(o.view.map.layers.items);const r=[];t.includes(" and ")&&t.split(" and ").forEach((e=>{if(!(e.includes("PK")||e.includes("Año")||e.includes("V")||e.includes("NACVS")||e.includes("Carretera")||e.includes("NACV")||e.includes("NACVM"))){let t=e.replace(/\(/g,"").replace(/\)/g,"");t="("+t+")",t=t.split(" IN "),t=t[0]+" IN ("+t[1]+")",r.push(t)}})),t=r.join(" and "),V(t),d(!1),u([]),clearInterval(e)}}),200);return()=>clearInterval(e)}),[$]);const P=()=>{o&&(V(null),u([]),a("Ninguno"),d(!1))};return w((()=>{if(0===l.length){const e=Object.keys(s).filter((e=>s[e]));u(e)}}),[]),w((()=>{if(l&&o&&b){const e=function(e){let t="";if(e.length>1){const r=e.join("', '");t=f?"("+f+" IN ('"+r+"'))":"(Tipo_accidente IN ('"+r+"'))"}else{const r=e[0];t=f?"("+f+" IN ('"+r+"'))":"(Tipo_accidente IN ('"+r+"'))"}return t}(l);let t=M(o.view.map.layers.items);const r=[];console.log("jmvs.view.map"),console.log(o.view.map),t.includes(" and ")&&t.split(" and ").forEach((e=>{if(!(e.includes("PK")||e.includes("Año")||e.includes("V")||e.includes("NACVS")||e.includes("Carretera")||e.includes("NACV")||e.includes("NACVM"))){let t=e.replace(/\(/g,"").replace(/\)/g,"");t="("+t+")",t=t.split(" IN "),t=t[0]+" IN ("+t[1]+")",r.push(t)}})),t=r.join(" and "),p?V(""===t?e:t+" and "+e):t.includes(" and "+e+")")?V(t.replace(" and "+e+")","")):t.includes(" and "+e)?V(t.replace(" and "+e,"")):t.includes(e+" and ")?V(t.replace(e+" and ","")):V(t.replace(e,""));const n=M(o.view.map.layers.items);a(function(e){console.log("clausula"),console.log(e);const t=[];if(e.includes(" and ")&&e.split(" and ").forEach((e=>{e.includes("PK")||e.includes("Año")||e.includes("V")||e.includes("NACVS")||e.includes("Carretera")||e.includes("NACV")||e.includes("NACVM")||t.push(e)})),e=t.length>1?t.join(" and "):1===t.length?t[0]:null){e=e.replace(/\(/g,"").replace(/\)/g,"");const t=[];if(e.includes(" and "))e.split(" and ").forEach((e=>{let r=e.split(" IN ")[1],o=[];console.log(r),console.log("condicion"),r.includes("', '")?(r=r.split("', '"),r.forEach((e=>{let t=e.includes(",")?e.replace(",",";"):e;t=t.includes("'")?t.replace(/'/g,""):t,o.push(t)})),o=o.join(", "),t.push(o)):t.push(r.includes(",")?r.replace(",",";").replace(/'/g,""):r.replace(/'/g,""))}));else{let r=e.split(" IN ")[1],o=[];r.includes("', '")?(r=r.split("', '"),r.forEach((e=>{let t=e.includes(",")?e.replace(",",";"):e;t=t.includes("'")?t.replace(/'/g,""):t,o.push(t)})),o=o.join(", "),t.push(o)):t.push(r.includes(",")?r.replace(",",";"):r)}return t.join(", ")}return"Ninguno"}(n))}}),[p]),e.React.createElement("div",{style:{display:"flex",width:"100%",height:"100%"}},t.useMapWidgetIds&&1===t.useMapWidgetIds.length&&e.React.createElement(h.JimuMapViewComponent,{useMapWidgetId:null===(r=t.useMapWidgetIds)||void 0===r?void 0:r[0],onActiveViewChange:e=>{console.log("JimuMapView recibido:",e),e&&n(e)}}),e.React.createElement("div",{style:{marginRight:"10px",marginLeft:"5px",marginTop:"10px"}},e.React.createElement("div",{style:{marginBottom:"10px"}},e.React.createElement(x.Switch,{checked:p,onChange:()=>{d(!p)}})),e.React.createElement("div",{style:{maxHeight:"240px",overflow:"auto"}},s.filter((e=>e&&e.value&&""!==e.value)).map(((t,r)=>{const o=l.includes(t.value);return e.React.createElement("label",{key:r,style:{display:"flex",alignItems:"center",marginBottom:"5px",cursor:p?"default":"pointer",userSelect:"none"}},e.React.createElement("input",{type:"checkbox",disabled:p,checked:o,onChange:()=>function(e){const t=e.value;if(l.includes(t)){let e=[...l];e=e.filter((e=>e!==t)),u(e)}else u([...l,t])}(t),style:{opacity:0,width:0,height:0,position:"absolute"}}),e.React.createElement("span",{style:{height:"18px",width:"18px",border:"2px solid "+(o?"#007BFF":"#ccc"),backgroundColor:o?"#007BFF":"white",display:"inline-block",marginRight:"10px",borderRadius:"4px",position:"relative"}},o&&e.React.createElement("span",{style:{content:"",position:"absolute",top:"1px",left:"4px",width:"5px",height:"10px",border:"solid white",borderWidth:"0 2px 2px 0",transform:"rotate(45deg)"}})),e.React.createElement("span",{style:{color:o?"#007BFF":"#999"}},t.value))}))),"Ninguno"!==c&&c.length>0&&e.React.createElement("div",{style:{marginTop:"10px"}},e.React.createElement("button",{onClick:P,style:{backgroundColor:"white",color:"#333",border:"1px solid #ccc",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s ease"},onMouseOver:e=>e.target.style.backgroundColor="#d5d5d5",onMouseOut:e=>e.target.style.backgroundColor="white"},"Eliminar todos los filtros"))))}function _(e){s.p=e}})(),i})())}}}));
System.register(["jimu-core/react","jimu-core","jimu-ui"],(function(e,t){var a={},n={},l={};return{setters:[function(e){a.default=e.default,a.useEffect=e.useEffect,a.useRef=e.useRef,a.useState=e.useState},function(e){n.DataSourceManager=e.DataSourceManager},function(e){l.Alert=e.Alert,l.Button=e.Button,l.Checkbox=e.Checkbox,l.Collapse=e.Collapse,l.Loading=e.Loading}],execute:function(){e((()=>{var e={8891:e=>{"use strict";e.exports=n},1315:e=>{"use strict";e.exports=a},726:e=>{"use strict";e.exports=l}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,r),l.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var i={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(i),r.d(i,{__set_webpack_public_path__:()=>g,default:()=>p});var e=r(1315),t=r(8891),a=r(726),n=function(e,t,a,n){return new(a||(a=Promise))((function(l,r){function i(e){try{s(n.next(e))}catch(e){r(e)}}function o(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,o)}s((n=n.apply(e,t||[])).next())}))};const l="__ESRI_NULL__",o=["Tipo_accidente","Subtipo_Accidente","Sentido","Superficie","Luminosidad","Factores_atmosfericos","Tipo_dia","Factor_concurrente_1"],s={Tipo_accidente:"Tipo de accidente",Subtipo_Accidente:"Subtipo de accidente",Sentido:"Sentido",Superficie:"Superficie",Luminosidad:"Luminosidad",Factores_atmosfericos:"Factores atmosféricos",Tipo_dia:"Tipo de día",Factor_concurrente_1:"Factor concurrente"},d=e=>{var t;return null!==(t=s[e])&&void 0!==t?t:e.replace(/_/g," ")},c={},u=e=>Object.fromEntries(Object.entries(e).map((([e,t])=>[e,new Set(t)]))),f=e=>new Promise((t=>setTimeout(t,e)));function p(r){var i,s,p;const g=null===(s=null===(i=r.useDataSources)||void 0===i?void 0:i[0])||void 0===s?void 0:s.dataSourceId,y=(0,e.useRef)(null),[v,m]=(0,e.useState)(!1),[b,h]=(0,e.useState)(!1),[x,S]=(0,e.useState)([]),[E,w]=(0,e.useState)({}),[j,k]=(0,e.useState)({}),[O,C]=(0,e.useState)(null),[B,z]=(0,e.useState)(null),[_,F]=(0,e.useState)(!1),[R,I]=(0,e.useState)([]),L=(0,e.useRef)([]);(0,e.useEffect)((()=>{L.current=R}),[R]);const A=null===(p=null==r?void 0:r.stateProps)||void 0===p?void 0:p.doClearAllTs,T=(0,e.useRef)(null),D={wrapper:{position:"relative",height:"100%",display:"flex",flexDirection:"column",background:"var(--light-200, #f5f5f7)",borderRadius:12,boxShadow:"0 1px 4px rgba(0,0,0,0.08)",overflow:"hidden"},header:{position:"sticky",top:0,zIndex:2,padding:"10px 12px",background:"linear-gradient(135deg, #005e95, #0090c5)",color:"#ffffff",display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},headerLeft:{display:"flex",alignItems:"center",gap:8},titleIcon:{width:24,height:24,borderRadius:999,border:"1px solid rgba(255,255,255,0.4)",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.12)",color:"#ffffff"},headerRight:{display:"flex",alignItems:"center",gap:6},content:{padding:10,paddingTop:8,overflow:"auto",flex:1,display:"flex",flexDirection:"column",gap:8},badgeRow:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6,fontSize:11,color:"var(--dark-600, #555)"},badge:{padding:"2px 8px",borderRadius:999,background:"#ffffff",boxShadow:"0 0 0 1px rgba(0,0,0,0.04)"},groupCard:{background:"#ffffff",borderRadius:10,boxShadow:"0 1px 3px rgba(0,0,0,0.06)",padding:"6px 8px"},headRow:{cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 2px"},headLeft:{display:"flex",alignItems:"center",gap:8,fontWeight:600,fontSize:13,color:"var(--dark-700, #333)"},chevronBox:{width:18,height:18,borderRadius:999,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,background:"var(--light-200, #f3f3f5)",color:"var(--dark-500, #666)"},chip:{fontSize:11,padding:"2px 8px",borderRadius:999,background:"var(--light-200, #f3f3f5)",color:"var(--dark-600, #555)"},inner:{marginTop:6,paddingTop:6,borderTop:"1px dashed var(--light-400, #e0e0e0)",display:"grid",gap:6},smallBtns:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:4},pillBtn:{borderRadius:999},optionRow:{display:"flex",alignItems:"center",padding:"2px 0"},optionLabel:{marginLeft:6,fontSize:12,color:"var(--dark-700, #333)"},applyOverlay:{position:"absolute",inset:0,background:"rgba(255,255,255,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:5},applyOverlayInner:{background:"#ffffff",padding:"8px 14px",borderRadius:999,boxShadow:"0 2px 6px rgba(0,0,0,0.18)",display:"flex",alignItems:"center",gap:8,fontSize:12,color:"var(--dark-700,#333)"}};(0,e.useEffect)((()=>{if(C(null),!g)return;const e=t.DataSourceManager.getInstance().getDataSource(g);y.current=e,null==e||e.ready().then((()=>m(!0))).catch((e=>{console.error(e),m(!1),C("No se pudo inicializar el DataSource.")}))}),[g]),(0,e.useEffect)((()=>{var e;if(!v||!y.current||!g)return;const t=y.current.getSchema(),a=Object.keys(null!==(e=null==t?void 0:t.fields)&&void 0!==e?e:{}),n=o.filter((e=>a.includes(e)));S(n),0===n.length&&C("Los campos de filtro no existen en esta capa.");const l=c[g];l&&(w(Object.assign({},l.valuesByField)),k(u(l.selectedByField)))}),[v,g]),(0,e.useEffect)((()=>{var e;if(!v||!y.current||0===x.length||!g)return;if((null===(e=c[g])||void 0===e?void 0:e.valuesByField)&&Object.keys(c[g].valuesByField).length)return;let t=!1;h(!0),C(null);const a=e=>n(this,void 0,void 0,(function*(){var a;const n={where:"1=1",groupByFieldsForStatistics:[e],outStatistics:[{statisticType:"count",onStatisticField:e,outStatisticFieldName:"n"}],orderByFields:[`${e} ASC`],returnGeometry:!1,pageSize:2e3},r=yield y.current.query(n),i=(null!==(a=null==r?void 0:r.records)&&void 0!==a?a:[]).map((t=>{const a=t.getFieldValue(e);return null==a?l:String(a)})),o=Array.from(new Set(i));t||(w((t=>Object.assign(Object.assign({},t),{[e]:o}))),k((t=>Object.assign(Object.assign({},t),{[e]:new Set(o)}))))}));return(()=>{n(this,void 0,void 0,(function*(){try{for(const e of x)yield a(e)}catch(e){console.error(e),t||C("Error consultando categorías.")}finally{t||h(!1)}}))})(),()=>{t=!0}}),[v,x,g]),(0,e.useEffect)((()=>{g&&x.length>0&&x.every((e=>Array.isArray(E[e])))&&(c[g]={availableFields:[...x],valuesByField:Object.assign({},E),selectedByField:u(j)})}),[g,x,E,j]);const N=e=>n(this,void 0,void 0,(function*(){var t;const a=y.current;if(!a||0===x.length)return;const n=null!=e?e:j,i=[];for(const e of x){const a=null!==(t=E[e])&&void 0!==t?t:[],r=n[e];if(!r)continue;if(0===r.size){i.push("1=0");continue}if(r.size===a.length)continue;const o=Array.from(r).filter((e=>e!==l)),s=r.has(l),d=o.map((e=>`'${e.replace(/'/g,"''")}'`)),c=[d.length?`${e} IN (${d.join(",")})`:"",s?`${e} IS NULL`:""].filter(Boolean).join(" OR ");i.push(`(${c})`)}const o=i.length?i.join(" AND "):"1=1";yield a.updateQueryParams({where:o},r.id)})),P=(e=!1)=>n(this,void 0,void 0,(function*(){var t;const a={};for(const e of x)a[e]=new Set(null!==(t=E[e])&&void 0!==t?t:[]);k(a),z(null),g&&(c[g]||(c[g]={availableFields:[...x],valuesByField:Object.assign({},E),selectedByField:{}}),c[g].selectedByField=Object.fromEntries(Object.entries(a).map((([e,t])=>[e,new Set(t)])))),e&&(I([u(a)]),yield N(a))}));(0,e.useEffect)((()=>{const e=Number(A)||0;e&&e!==T.current&&x.length>0&&x.every((e=>Array.isArray(E[e])))&&(P(!0),T.current=e)}),[A,x,E]);const $=x.length,M=x.filter((e=>{var t;const a=null!==(t=E[e])&&void 0!==t?t:[],n=j[e];return!!n&&n.size>0&&n.size<a.length})).length,U=R.length>1;return e.default.createElement("div",{style:D.wrapper},_&&e.default.createElement("div",{style:D.applyOverlay},e.default.createElement("div",{style:D.applyOverlayInner},e.default.createElement(a.Loading,null),e.default.createElement("span",null,"Actualizando gráficos…"))),e.default.createElement("div",{style:D.header},e.default.createElement("div",{style:D.headerLeft,title:"Filtros"},e.default.createElement("div",{style:D.titleIcon},e.default.createElement("svg",{viewBox:"0 0 24 24",width:14,height:14,"aria-hidden":"true",focusable:"false",style:{display:"block"}},e.default.createElement("path",{d:"M4 4h16l-5.5 6.6v4.7l-4 2.5v-7.2L4 4z",fill:"currentColor"})))),e.default.createElement("div",{style:D.headerRight},e.default.createElement(a.Button,{size:"sm",type:"primary",onClick:()=>n(this,void 0,void 0,(function*(){try{F(!0);const e=u(j);I((t=>[...t,e])),yield f(350),yield N(e)}finally{F(!1)}})),disabled:!v||b||0===x.length||_},_?"Consultando…":"Consultar"),e.default.createElement(a.Button,{size:"sm",type:"default",onClick:()=>{P(!1)},disabled:_,title:"Restablece todos los filtros (requiere Consultar)"},"Limpiar"))),e.default.createElement("div",{style:D.content},e.default.createElement("div",{style:D.badgeRow},g?e.default.createElement(e.default.Fragment,null,e.default.createElement("span",{style:D.badge},"Categorías: ",e.default.createElement("strong",null,$)),e.default.createElement("span",{style:D.badge},"Filtros activos: ",e.default.createElement("strong",null,M)),e.default.createElement(a.Button,{size:"sm",type:"secondary",style:{borderRadius:999,fontSize:11,padding:"0 10px"},disabled:!U||_,onClick:()=>n(this,void 0,void 0,(function*(){const e=L.current;if(e.length<2)return;const t=e.slice(0,-1),a=u(t[t.length-1]);I(t),k(a);try{F(!0),yield f(350),yield N(a)}finally{F(!1)}}))},"Consulta anterior")):e.default.createElement("span",{style:Object.assign(Object.assign({},D.badge),{background:"#ffe9e5",color:"#b43424"})},"Sin DataSource configurado")),O&&e.default.createElement(a.Alert,{type:"error",text:O,className:"mt-1 mb-1"}),b&&e.default.createElement(a.Loading,null),!g&&e.default.createElement(a.Alert,{type:"warning",text:"Selecciona un DataSource en el panel de configuración del widget.",className:"mt-2"}),x.map((t=>{var n,r;const i=null!==(n=E[t])&&void 0!==n?n:[],o=null!==(r=j[t])&&void 0!==r?r:new Set,s=B===t,c=i.length,u=o.size>0&&o.size<c,f=c>0&&o.size===c,p={width:8,height:8,borderRadius:"50%",boxShadow:"0 0 0 1px rgba(0,0,0,0.05)",backgroundColor:u?"#ffb020":f?"#22a160":"#d0d0d0"},g=Object.assign(Object.assign({},D.chip),{background:u?"#fff4e5":D.chip.background,color:u?"#b15c00":D.chip.color});return e.default.createElement("div",{key:t,style:D.groupCard},e.default.createElement("div",{style:D.headRow,onClick:()=>(e=>z((t=>t===e?null:e)))(t)},e.default.createElement("div",{style:D.headLeft},e.default.createElement("div",{style:D.chevronBox},s?"▾":"▸"),e.default.createElement("span",null,d(t))),e.default.createElement("div",{style:{display:"flex",alignItems:"center",gap:6}},e.default.createElement("div",{style:p}),e.default.createElement("span",{style:g},o.size,"/",i.length||0))),e.default.createElement(a.Collapse,{isOpen:s},e.default.createElement("div",{style:D.inner},e.default.createElement("div",{style:D.smallBtns},e.default.createElement(a.Button,{size:"sm",type:"tertiary",style:D.pillBtn,onClick:()=>k((e=>Object.assign(Object.assign({},e),{[t]:new Set(i)})))},"Seleccionar todo"),e.default.createElement(a.Button,{size:"sm",type:"tertiary",style:D.pillBtn,onClick:()=>k((e=>Object.assign(Object.assign({},e),{[t]:new Set})))},"Deseleccionar todo")),0===i.length&&e.default.createElement("div",{style:{fontSize:12,color:"var(--dark-500,#666)"}},"Cargando valores…"),i.map((n=>{return e.default.createElement("div",{key:`${t}|${n}`,style:D.optionRow},e.default.createElement(a.Checkbox,{checked:o.has(n),onChange:(e,a)=>((e,t,a)=>{k((n=>{var l;const r=new Set(null!==(l=n[e])&&void 0!==l?l:[]);return a?r.add(t):r.delete(t),Object.assign(Object.assign({},n),{[e]:r})}))})(t,n,a)}),e.default.createElement("span",{style:D.optionLabel},(r=n)===l?"(valor vacío)":r));var r})))))})),v&&g&&0===x.length&&!O&&!b&&e.default.createElement(a.Alert,{type:"info",text:"No se han encontrado campos configurados para filtrar en esta capa."})))}function g(e){r.p=e}})(),i})())}}}));